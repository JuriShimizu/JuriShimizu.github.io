<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[JURI★GIS]]></title>
  <subtitle><![CDATA[知識ゼロからGeoなSEを目指すブログ]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://jurishimizu.github.io/"/>
  <updated>2015-03-22T11:16:05.011Z</updated>
  <id>http://jurishimizu.github.io/</id>
  
  <author>
    <name><![CDATA[JuriShimizu]]></name>
    
  </author>
  
  <generator uri="http://zespia.tw/hexo/">Hexo</generator>
  
  <entry>
    <title><![CDATA[GeoJSONのデータをleafletを使って出力]]></title>
    <link href="http://jurishimizu.github.io/2015/03/22/output-geojson-using-the-leaflet/"/>
    <id>http://jurishimizu.github.io/2015/03/22/output-geojson-using-the-leaflet/</id>
    <published>2015-03-22T05:08:20.000Z</published>
    <updated>2015-03-22T11:16:00.000Z</updated>
    <content type="html"><![CDATA[<p>最近ずっとPostGISをいじっていろいろやっていたわけですが、<br>そろそろ地図を動かしたりしてみたい！！<br>ということで<a href="http://leafletjs.com/" target="_blank" rel="external">leaflet</a>に挑戦してみます。</p>
<a id="more"></a>

<p>東京の観光名所のデータを地図上に表示することを目標にします。</p>
<p>地図上に大量のマーカーを置く時は、<a href="http://ja.wikipedia.org/wiki/GeoJSON" target="_blank" rel="external">eoJSON</a>を利用するとらしいので、<br>観光地のデータはGeoJSON形式にします。</p>
<p>そのためにやらなくてはいけないことは、、、</p>
<ol>
<li>leafletで地図を表示</li>
<li>地図にマーカーを表示</li>
<li>GeoJSONの観光地データを準備</li>
<li>地図にGeoJSONのデータを表示</li>
</ol>
<p>という感じになります。</p>
<p>ひとつひとつやっていきます。</p>
<h2 id="leafletで地図を表示">leafletで地図を表示</h2>
<p>leafletとは地図のためのJavaScriptライブラリ。<br>OSMなどのオープンデータを簡単に表示することができます。</p>
<p><code>&lt;head&gt;</code>タグ内でCSSとLeafletを読み込みます。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"</span>&gt;</span></div></pre></td></tr></table></figure>

<p>地図を描画したいところにタグを置きます。<br>今回は<code>&lt;body&gt;</code>タグの中におきました。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"map"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>CSSで地図の幅、高さを指定</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="id">#map</span><span class="rules">{</span></div><div class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;</div><div class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">500px</span></span></span>;</div><div class="line"><span class="rule">}</span></div></pre></td></tr></table></figure>

<p><code>&lt;script&gt;</code>タグ内で地図のデフォルト値を設定し、地図を描画します。<br>今回は東京タワーの場所をデフォルトにしました。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//地図のデフォルト値</span></div><div class="line"><span class="keyword">var</span> map = L.map(<span class="string">'map'</span>).setView([<span class="number">35.65863174</span>　, <span class="number">139.74542422</span>], <span class="number">14</span>);</div><div class="line"></div><div class="line"><span class="comment">//OSMレイヤー追加</span></div><div class="line">L.tileLayer(</div><div class="line">	<span class="string">'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'</span></div><div class="line">	,{</div><div class="line">	    attribution: <span class="string">'Map data &copy; &lt;a href="http://openstreetmap.org"&gt;OpenStreetMap&lt;/a&gt;'</span>,</div><div class="line">	    maxZoom: <span class="number">18</span></div><div class="line">	}</div><div class="line">).addTo(map);</div></pre></td></tr></table></figure>

<p>地図を表示するのはたったこれだけで完了！</p>
<h2 id="地図にマーカーを表示">地図にマーカーを表示</h2>
<p>東京タワーの場所にマーカーを表示します。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> marker = L.marker([<span class="number">35.65863174</span>　, <span class="number">139.74542422</span>])</div><div class="line">    .bindPopup(<span class="string">"&lt;h3&gt;東京タワー&lt;/h3&gt;"</span>)</div><div class="line">    .addTo(map);</div></pre></td></tr></table></figure>

<p>こんな感じで表示できました！</p>
<p><img src="leaflet_1.png" alt="leaflet"></p>
<h2 id="GeoJSONの観光地データを準備">GeoJSONの観光地データを準備</h2>
<p>PostGISにいれたOSMのデータから観光地のデータを抜き出します。</p>
<p><code>As_Geojson</code>を使うと、GeoJSON形式で出力できるようです。<br>検索条件については<a href="http://www.jurigis.me/2015/02/28/conditions-in-postgis/" target="_blank" rel="external">こちら</a>を参照。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SELECT</span> row_to_json(feature)</span></div><div class="line"><span class="keyword">FROM</span> (</div><div class="line">  <span class="keyword">select</span></div><div class="line">    <span class="string">'Feature'</span> <span class="keyword">AS</span> type,</div><div class="line">    ST_AsGeoJSON(ST_Transform(trm.way,<span class="number">4326</span>))::json <span class="keyword">AS</span> geometry,</div><div class="line">    row_to_json((</div><div class="line">      <span class="keyword">SELECT</span> p <span class="keyword">FROM</span> (</div><div class="line">        <span class="keyword">SELECT</span> trm.name</div><div class="line">      ) <span class="keyword">AS</span> p</div><div class="line">    )) <span class="keyword">AS</span> properties</div><div class="line">  <span class="keyword">from</span></div><div class="line">    planet_osm_point trm</div><div class="line">    ,planet_osm_polygon tky</div><div class="line">  <span class="keyword">where</span></div><div class="line">    tky.name = <span class="string">'東京都'</span></div><div class="line">    <span class="keyword">and</span> tky.boundary = <span class="string">'administrative'</span></div><div class="line">    <span class="keyword">and</span> trm.tourism <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></div><div class="line">    <span class="keyword">and</span> trm.name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></div><div class="line">    <span class="keyword">and</span> ST_Contains(tky.way,trm.way)</div><div class="line">) <span class="keyword">AS</span> feature</div><div class="line">;</div></pre></td></tr></table></figure>

<p>こうすると、こんな感じの検索結果になります。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">{"<span class="attribute">type</span>":<span class="value"><span class="string">"Feature"</span></span>,"<span class="attribute">geometry</span>":<span class="value">{"<span class="attribute">type</span>":<span class="value"><span class="string">"Point"</span></span>,"<span class="attribute">coordinates</span>":<span class="value">[<span class="number">139.729260969094</span>,<span class="number">35.6604319722521</span>]</span>}</span>,"<span class="attribute">properties</span>":<span class="value">{"<span class="attribute">name</span>":<span class="value"><span class="string">"森美術館"</span></span>}</span>}</div></pre></td></tr></table></figure>

<h2 id="GeoJSONのデータを地図で表示。">GeoJSONのデータを地図で表示。</h2>
<p><code>&lt;script&gt;</code>タグ内でGeoJSONのデータを定義<br>先ほど取得したデータを書いておきます。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> geojsonFeature = [</div><div class="line">  {<span class="string">"type"</span>:<span class="string">"Feature"</span>,<span class="string">"geometry"</span>:{<span class="string">"type"</span>:<span class="string">"Point"</span>,<span class="string">"coordinates"</span>:[<span class="number">139.729260969094</span>,<span class="number">35.6604319722521</span>]},<span class="string">"properties"</span>:{<span class="string">"name"</span>:<span class="string">"森美術館"</span>}}</div><div class="line">]</div></pre></td></tr></table></figure>

<p>マーカーをセットします</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">L.geoJson(geojsonFeature).addTo(<span class="built_in">map</span>);</div></pre></td></tr></table></figure>

<p>マーカーをクリックしたときにポップアップ表示をさせる場合はこんな感じです。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">L.geoJson(</div><div class="line">geojsonFeature,</div><div class="line">{</div><div class="line">    onEachFeature: <span class="function"><span class="keyword">function</span><span class="params">(feature, layer)</span></span>{</div><div class="line">        layer.name(feature.properties.popupContent);</div><div class="line">    }</div><div class="line">}</div><div class="line">).addTo(map);</div></pre></td></tr></table></figure>

<h2 id="GeoJSONのデータを外だしする">GeoJSONのデータを外だしする</h2>
<p>大量のデータをhtmlファイルに書いていくのはあんまりイケてないので、<br>GeoJSONのデータを外だしします。</p>
<p>jQueryを使うと簡単らしいので、やってみます。</p>
<p>こんな感じで前項で取得したデータをもとにGeoJsonのデータファイルを用意します。<br>ディレクトリは<code>./data/map.geojson</code>とします。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  "<span class="attribute">type</span>": <span class="value"><span class="string">"FeatureCollection"</span></span>,</div><div class="line">  "<span class="attribute">features</span>": <span class="value">[</span></div><div class="line">  {"<span class="attribute">type</span>":<span class="value"><span class="string">"Feature"</span></span>,"<span class="attribute">geometry</span>":<span class="value">{"<span class="attribute">type</span>":<span class="value"><span class="string">"Point"</span></span>,"<span class="attribute">coordinates</span>":<span class="value">[<span class="number">139.74542422</span>,<span class="number">35.65863174</span>]</span>}</span>,"<span class="attribute">properties</span>":<span class="value">{"<span class="attribute">name</span>":<span class="value"><span class="string">"東京タワー (Tokyo Tower)"</span></span>}</span>}</div><div class="line">  ,{"<span class="attribute">type</span>":<span class="value"><span class="string">"Feature"</span></span>,"<span class="attribute">geometry</span>":<span class="value">{"<span class="attribute">type</span>":<span class="value"><span class="string">"Point"</span></span>,"<span class="attribute">coordinates</span>":<span class="value">[<span class="number">139.729260969094</span>,<span class="number">35.6604319722521</span>]</span>}</span>,"<span class="attribute">properties</span>":<span class="value">{"<span class="attribute">name</span>":<span class="value"><span class="string">"森美術館"</span></span>}</span>}</div><div class="line">・・・・</div><div class="line"> ]</div><div class="line">}</div></pre></td></tr></table></figure>

<p><code>&lt;head&gt;</code>タグ内でjQueryを読み込みます。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://code.jquery.com/jquery-2.1.1.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<p>データを読み込んで、表示します。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$.getJSON(<span class="string">"./data/map.geojson"</span>, <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>{</div><div class="line">    <span class="keyword">var</span> geojson = L.geoJson(data, {</div><div class="line">        onEachFeature: <span class="function"><span class="keyword">function</span> <span class="params">(feature, layer)</span> </span>{</div><div class="line">            layer.bindPopup(feature.properties.name);</div><div class="line">        }</div><div class="line">    });</div><div class="line">    geojson.addTo(map);</div><div class="line">});</div></pre></td></tr></table></figure>

<p>こんな感じで、マーカーがたくさん表示されました！</p>
<p><img src="leaflet_2.png" alt="leaflet"></p>
<p>あんまり難しいことはやっていないのですが、<br>これだけでかなり時間がかかってしまいました、、、</p>
<p>自分で地図を動かせるのは面白いので、<br>これからもちょいちょい勉強していきたいと思います！</p>
<h3 id="参考にさせていただきました">参考にさせていただきました</h3>
<p><a href="http://shimz.me/blog/leaflet-js/4142" target="_blank" rel="external">ぬるぬる動く！Web地図クライアント「Leaflet」を使おう！ |  #GUNMAGISGEEK</a><br><a href="http://unguis.cre8or.jp/web/6341" target="_blank" rel="external">Leaflet - OSMにgeoJSONでマーカーをつけたりできる便利なJavaScriptライブラリ | アンギス</a><br><a href="http://qiita.com/kshigeru/items/8940ecf7f261a6b01ed0" target="_blank" rel="external">PostGISからGeoJSON出力するときに属性を付与する - Qiita</a><br><a href="http://lyzidiamond.com/posts/external-geojson-and-leaflet-the-other-way/" target="_blank" rel="external">External GeoJSON and Leaflet: The Other Way(s)</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>最近ずっとPostGISをいじっていろいろやっていたわけですが、<br>そろそろ地図を動かしたりしてみたい！！<br>ということで<a href="http://leafletjs.com/" target="_blank" rel="external">leaflet</a>に挑戦してみます。</p>
]]>
    
    </summary>
    
      <category term="leaflet" scheme="http://jurishimizu.github.io/tags/leaflet/"/>
    
      <category term="osm" scheme="http://jurishimizu.github.io/tags/osm/"/>
    
      <category term="geojson" scheme="http://jurishimizu.github.io/tags/geojson/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PostGISでGeoなINSERT]]></title>
    <link href="http://jurishimizu.github.io/2015/03/15/insert-in-postgis/"/>
    <id>http://jurishimizu.github.io/2015/03/15/insert-in-postgis/</id>
    <published>2015-03-15T05:23:48.000Z</published>
    <updated>2015-03-15T13:59:43.000Z</updated>
    <content type="html"><![CDATA[<p>PostGISで地物をINSERTしてみます。</p>
<a id="more"></a>

<h2 id="準備">準備</h2>
<p>テスト用にデータベースを用意しておきます。<br>詳細は<a href="http://www.jurigis.me/2015/01/09/postgis-install-2/" target="_blank" rel="external">こちら</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">sudo</span> su - postgres</div><div class="line">$ createdb test</div><div class="line">$ psql <span class="operator">-d</span> test</div></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">test=# <span class="operator"><span class="keyword">create</span> extension Postgis;</span></div><div class="line"><span class="operator"><span class="keyword">CREATE</span> EXTENSION</span></div><div class="line">test=# <span class="keyword">SELECT</span> Postgis_full_version() ;</div><div class="line">                                                                        postgis_full_version</div><div class="line"></div><div class="line"><span class="comment">---------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div><div class="line"> POSTGIS="2.1.5 r13152" GEOS="3.4.2-CAPI-1.8.2 r3921" PROJ="Rel. 4.8.0, 6 March 2012" GDAL="GDAL 1.9.2, released 2012/10/08" LIBXML="2.7.6" LIBJSON="UNKNOWN" RASTER</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<h2 id="TABLE作成">TABLE作成</h2>
<p>TABLEを作成します。</p>
<p>GEOMETRYの種類は点・線・面の３種類なので、３つテーブルを用意します。</p>
<p>図形タイプと、SRIDを指定します。<br>SRIDについては<a href="http://www.jurigis.me/2015/02/05/about-srid/" target="_blank" rel="external">こちら</a>を参照</p>
<p>今回は 4326（WGS84、地理座標系）にします。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">test=# <span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sample_point (</span></div><div class="line">test(# id <span class="built_in">SERIAL</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span></div><div class="line">test(#  , name <span class="built_in">text</span></div><div class="line">test(#  , geom GEOMETRY (POINT , <span class="number">4326</span>)</div><div class="line">test(# );</div><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span></div><div class="line">test=#</div><div class="line">test=#</div><div class="line">test=# <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sample_line (</div><div class="line">test(# id <span class="built_in">SERIAL</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span></div><div class="line">test(#  , name <span class="built_in">TEXT</span></div><div class="line">test(#  , geom GEOMETRY (LINESTRING , <span class="number">4326</span>)</div><div class="line">test(# );</div><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span></div><div class="line">test=#</div><div class="line">test=#</div><div class="line">test=# <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sample_polygon (</div><div class="line">test(# id <span class="built_in">SERIAL</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span></div><div class="line">test(#  , name <span class="built_in">TEXT</span></div><div class="line">test(#  , geom GEOMETRY (POLYGON , <span class="number">4326</span>)</div><div class="line">test(# );</div><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span></div><div class="line">test=#</div></pre></td></tr></table></figure>

<h2 id="INSERT">INSERT</h2>
<p>データをINSERTしてみます。</p>
<p>GEOMETORY型はバイナリなので、<br><code>ST_GeomFromText</code>を使って、INSERTします。</p>
<p>緯度経度はスペースで区切って、空間参照系を指定します。</p>
<p>まずは<strong>点</strong>をINSERTしてみます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">test=# <span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sample_point(name,geom)</span></div><div class="line">test-# <span class="keyword">VALUES</span> (<span class="string">'point1'</span>,ST_GeomFromText(<span class="string">'POINT(35.67 139.75)'</span>,<span class="number">4326</span>));</div><div class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span></div></pre></td></tr></table></figure>

<p><strong>線</strong>を指定するときは、緯度経度をカンマで区切ります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">test=# <span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sample_line(name,geom)</span></div><div class="line">test-# <span class="keyword">VALUES</span> (<span class="string">'line1'</span>,ST_GeomFromText(<span class="string">'LINESTRING(35.67 139.75,35.67 139.755,35.675 139.755 )'</span>,<span class="number">4326</span>));</div><div class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span></div></pre></td></tr></table></figure>

<p><strong>面</strong>を指定するときは、緯度経度の最初と最後を同じにします。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">test=# <span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sample_polygon(name,geom)</span></div><div class="line">test-# <span class="keyword">VALUES</span> (<span class="string">'polygon1'</span>,ST_GeomFromText(<span class="string">'POLYGON((35.68 139.76,35.686 139.76,35.686 139.766,35.68 139.766 ,35.68 139.76 ))'</span>,<span class="number">4326</span>));</div><div class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span></div></pre></td></tr></table></figure>

<p>本当にINSERTできてるか、QGISで確認するとこんな感じです。<br>方法は<a href="http://www.jurigis.me/2015/01/29/display-postgis-data-in-qgis/" target="_blank" rel="external">こちら</a>を参照</p>
<p><img src="QGIS_01.png" alt="QGIS"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>PostGISで地物をINSERTしてみます。</p>
]]>
    
    </summary>
    
      <category term="postgis" scheme="http://jurishimizu.github.io/tags/postgis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[QGISで表示する地物を絞る＆ラベルを表示]]></title>
    <link href="http://jurishimizu.github.io/2015/03/08/filter-in-qgis/"/>
    <id>http://jurishimizu.github.io/2015/03/08/filter-in-qgis/</id>
    <published>2015-03-08T12:19:47.000Z</published>
    <updated>2015-03-08T13:14:56.000Z</updated>
    <content type="html"><![CDATA[<p>今日はQGISの使い方についての小ネタです。</p>
<a id="more"></a>

<h2 id="表示する地物を絞る">表示する地物を絞る</h2>
<p>まず、全部の地物を表示しているとこんな感じ<br>場所は新宿らへんです</p>
<p><img src="QGIS_01.png" alt="絞り込みなし"></p>
<p>ポイントの表示をファストフードだけに絞ってみます。</p>
<p>レイヤを右クリック→スタイル の画面で、「ルールに基づいた」を選択<br><code>(no filter)</code>とかいてあるところをクリックして、条件を入力してOKを押します。</p>
<p><img src="QGIS_02.png" alt="レイヤプロパティ"></p>
<p><img src="QGIS_03.png" alt="レイヤプロパティ"></p>
<p>こんな感じでポイントが減りました</p>
<p><img src="QGIS_04.png" alt="絞り込みあり"></p>
<h2 id="地物のラベルを表示する">地物のラベルを表示する</h2>
<p>レイヤを右クリック→ラベル の画面で、ラベルとして表示したいカラム名を入力して、OKを押します</p>
<p><img src="QGIS_05.png" alt="レイヤプロパティ"></p>
<p>こんな感じでラベルが表示されます</p>
<p><img src="QGIS_06.png" alt="ラベル表示あり"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>今日はQGISの使い方についての小ネタです。</p>
]]>
    
    </summary>
    
      <category term="qgis" scheme="http://jurishimizu.github.io/tags/qgis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PostGISでGeoな検索条件]]></title>
    <link href="http://jurishimizu.github.io/2015/02/28/conditions-in-postgis/"/>
    <id>http://jurishimizu.github.io/2015/02/28/conditions-in-postgis/</id>
    <published>2015-02-28T07:09:17.000Z</published>
    <updated>2015-03-08T13:17:11.000Z</updated>
    <content type="html"><![CDATA[<p>すっかり勉強をサボってしまいましたが、<br>前回に引き続き、OSMのデータを使ってPostGISのGeoなSQLを学んでいきます！</p>
<p>今回はGeoな検索条件です。</p>
<a id="more"></a>

<h4 id="ST_Within(geometry_A_,_geometry_B)">ST_Within(geometry A , geometry B)</h4>
<p>ジオメトリAが完全にジオメトリBの中に含まれているときにTRUEを返します。</p>
<p>台東区内にあるファストフード店をselectしてみます</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span></span></div><div class="line">japan-#     fst.name</div><div class="line">japan-# <span class="keyword">from</span></div><div class="line">japan-#     planet_osm_point fst</div><div class="line">japan-#     ,planet_osm_polygon tit</div><div class="line">japan-# <span class="keyword">where</span></div><div class="line">japan-#     tit.name <span class="keyword">like</span> <span class="string">'台東%'</span></div><div class="line">japan-#     <span class="keyword">and</span> tit.boundary = <span class="string">'administrative'</span></div><div class="line">japan-#     <span class="keyword">and</span> tit.admin_level = <span class="string">'7'</span></div><div class="line">japan-#     <span class="keyword">and</span> fst.amenity = <span class="string">'fast_food'</span></div><div class="line">japan-#     <span class="keyword">and</span> ST_Within(fst.way,tit.way)</div><div class="line">japan-# ;</div><div class="line">            name</div><div class="line"><span class="comment">----------------------------</span></div><div class="line"> 麺昇七辻</div><div class="line"> かめや</div><div class="line"> 東京チカラ飯</div><div class="line"> フレッシュネスバーガー</div><div class="line"> 吉野家</div><div class="line"> 奥州麺処 秘伝</div><div class="line"> 川中島うどん店</div><div class="line"> 日高屋</div><div class="line"> 富士そば</div><div class="line"> サブウェイ</div><div class="line"> ケンタッキーフライドチキン</div><div class="line"> マクドナルド</div><div class="line"> 回転寿司 大江戸</div><div class="line"> 味噌麺</div><div class="line"> マクドナルド</div><div class="line"> 味噌屋 せいべえ</div><div class="line"> 吉野家</div><div class="line"> かつや</div><div class="line"> 富士そば</div><div class="line"> Freshness Burger</div><div class="line"> 楽釜製麺所</div><div class="line"> まぐろ人</div><div class="line"> 寿司食べ放題</div><div class="line"> 藪そば</div><div class="line"> 大江戸 回転寿司</div><div class="line"> 東尋坊</div><div class="line"> てん屋</div><div class="line"></div><div class="line"> 元祖寿司</div><div class="line"> 牛の力</div><div class="line"></div><div class="line"> モスバーガー</div><div class="line"></div><div class="line"> Yoshinoya</div><div class="line"> すき家</div><div class="line"> McDonalds</div><div class="line"> たい焼き たいち</div><div class="line"> 麺八</div><div class="line"> 松屋</div><div class="line"> 日本海</div><div class="line"> Sukiya</div><div class="line"> デリカ ぱくぱく</div><div class="line"> モスバーガー</div><div class="line"> ら麺亭 (Ramen-tei)</div><div class="line"> 松屋</div><div class="line"> ケンタッキーフライドチキン</div><div class="line"> 銀だこ (Gindaco)</div><div class="line"> CoCo壱番屋</div><div class="line">(48 rows)</div></pre></td></tr></table></figure>

<p>ファストフード？？？みたいなお店もありますが、ちゃんとselectできました。</p>
<h4 id="ST_Contains(geometry_A,_geometry_B_)">ST_Contains(geometry A, geometry B )</h4>
<p>ST_Withinの真逆です。</p>
<p>ジオメトリBが完全にジオメトリAの中に含まれているときにTRUEを返します。</p>
<p>ST_Withinの代わりにST_Containsを使って、引数をひっくり返すと同じ結果になります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span></span></div><div class="line">japan-#     fst.name</div><div class="line">japan-# <span class="keyword">from</span></div><div class="line">japan-#     planet_osm_point fst</div><div class="line">japan-#     ,planet_osm_polygon tit</div><div class="line">japan-# <span class="keyword">where</span></div><div class="line">japan-#     tit.name <span class="keyword">like</span> <span class="string">'台東%'</span></div><div class="line">japan-#     <span class="keyword">and</span> tit.boundary = <span class="string">'administrative'</span></div><div class="line">japan-#     <span class="keyword">and</span> tit.admin_level = <span class="string">'7'</span></div><div class="line">japan-#     <span class="keyword">and</span> fst.amenity = <span class="string">'fast_food'</span></div><div class="line">japan-#     <span class="keyword">and</span> ST_Contains(tit.way,fst.way)</div><div class="line">japan-# ;</div><div class="line">            name</div><div class="line"><span class="comment">----------------------------</span></div><div class="line"> 麺昇七辻</div><div class="line"> かめや</div><div class="line"> 東京チカラ飯</div><div class="line">・・・・・</div><div class="line">(48 rows)</div></pre></td></tr></table></figure>

<h4 id="ST_Equals(geometry_A_,_geometry_B)">ST_Equals(geometry A , geometry B)</h4>
<p>AとBがまったく同じジオメトリのときにTRUEを返します。</p>
<p><code>ST_Equals(A,B)</code>は、<br><code>ST_Within(A,B) and ST_Contains(A,B)</code>と同じ意味になります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span></span></div><div class="line">japan-#     fst.osm_id</div><div class="line">japan-#     ,fst.name</div><div class="line">japan-# <span class="keyword">from</span></div><div class="line">japan-#     planet_osm_polygon fst</div><div class="line">japan-#     ,(<span class="keyword">select</span> way <span class="keyword">from</span> planet_osm_polygon <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">'東京%'</span> <span class="keyword">and</span> boundary = <span class="string">'administrative'</span>) tky</div><div class="line">japan-# <span class="keyword">where</span></div><div class="line">japan-#     ST_Equals(fst.way,tky.way)</div><div class="line">japan-#     <span class="keyword">and</span> name <span class="keyword">like</span> <span class="string">'東京%'</span></div><div class="line">japan-# ;</div><div class="line">  osm_id  |  name</div><div class="line"><span class="comment">----------+--------</span></div><div class="line"> -1543125 | 東京都</div><div class="line"> -1543125 | 東京都</div><div class="line"> -1543125 | 東京都</div><div class="line"> -1543125 | 東京都</div><div class="line"> -1543125 | 東京都</div><div class="line"> -1543125 | 東京都</div><div class="line"> -4479121 | 東京都</div><div class="line"> -1543125 | 東京都</div><div class="line">(8 rows)</div></pre></td></tr></table></figure>

<p>なぜか、まったく同じ東京がたくさん。。。<br>いろんな人が登録しちゃったってことですかね。。。</p>
<h4 id="ST_DWithin">ST_DWithin</h4>
<p>ジオメトリが，指定したジオメトリから指定した距離内にある場合に，TRUEを返します。<br>メートル単位で距離を指定するためにはgeography型にする必要があるようです。</p>
<p>東京駅の半径１km以内にあるファストフードを検索してみます</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span></span></div><div class="line">japan-#     fst.name</div><div class="line">japan-# <span class="keyword">from</span></div><div class="line">japan-#     planet_osm_point fst</div><div class="line">japan-#     ,(<span class="keyword">select</span> way <span class="keyword">from</span> planet_osm_point  <span class="keyword">where</span> name = <span class="string">'東京'</span>) tky</div><div class="line">japan-# <span class="keyword">where</span></div><div class="line">japan-#     ST_DWithin(geography(ST_Transform( fst.way,<span class="number">4326</span> )),geography(ST_Transform( tky.way,<span class="number">4326</span> )),<span class="number">1000</span>)</div><div class="line">japan-#     <span class="keyword">and</span> amenity = <span class="string">'fast_food'</span></div><div class="line">japan-# ;</div><div class="line">        name</div><div class="line"><span class="comment">--------------------</span></div><div class="line"> ロッテリア</div><div class="line"> よもだそば</div><div class="line"> 喜多方ラーメン坂内</div><div class="line"> サブウェイ</div><div class="line"> 吉野家</div><div class="line"> カレーショップC&C</div><div class="line"> 吉野家</div><div class="line"> 吉野家</div><div class="line"> サブウェイ</div><div class="line"> マクドナルド</div><div class="line"> 松屋</div><div class="line"> 富士そば</div><div class="line"> 小諸そば</div><div class="line"> 小諸そば</div><div class="line"> なか卯</div><div class="line">(15 rows)</div></pre></td></tr></table></figure>

<p>１５件ほどひっかかりました！</p>
<p>型の変換をしないとこんな感じで検索結果が変わってしまいます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span></span></div><div class="line">japan-#     fst.name</div><div class="line">japan-# <span class="keyword">from</span></div><div class="line">japan-#     planet_osm_point fst</div><div class="line">japan-#     ,(<span class="keyword">select</span> way <span class="keyword">from</span> planet_osm_point  <span class="keyword">where</span> name = <span class="string">'東京'</span>) tky</div><div class="line">japan-# <span class="keyword">where</span></div><div class="line">japan-#     ST_DWithin(fst.way,tky.way,<span class="number">1000</span>)</div><div class="line">japan-#     <span class="keyword">and</span> amenity = <span class="string">'fast_food'</span></div><div class="line">japan-# ;</div><div class="line">       name</div><div class="line"><span class="comment">-------------------</span></div><div class="line"> 吉野家</div><div class="line"> カレーショップC&C</div><div class="line"> 吉野家</div><div class="line"> サブウェイ</div><div class="line"> マクドナルド</div><div class="line"> 松屋</div><div class="line"> 富士そば</div><div class="line"> 小諸そば</div><div class="line"> 小諸そば</div><div class="line"> なか卯</div><div class="line">(10 rows)</div></pre></td></tr></table></figure>

<p>ST_DWithinの引数は、ラインやポリゴンでもOKです。</p>
<h4 id="ST_Touches">ST_Touches</h4>
<p>ジオメトリが共通のポイントを少なくとも一つ持ち，内部でインタセクトしない場合に，TRUEを返します。<br>つまり、接しているか？ってことですね</p>
<p>台東区に接している区を調べてみましょう！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span></span></div><div class="line">japan-#     cty.name</div><div class="line">japan-#     ,cty.admin_level</div><div class="line">japan-# <span class="keyword">from</span></div><div class="line">japan-#     planet_osm_polygon cty</div><div class="line">japan-#     ,planet_osm_polygon tit</div><div class="line">japan-# <span class="keyword">where</span></div><div class="line">japan-#     tit.name <span class="keyword">like</span> <span class="string">'台東%'</span></div><div class="line">japan-#     <span class="keyword">and</span> tit.boundary = <span class="string">'administrative'</span></div><div class="line">japan-#     <span class="keyword">and</span> tit.admin_level = <span class="string">'7'</span></div><div class="line">japan-#     <span class="keyword">and</span> cty.boundary = <span class="string">'administrative'</span></div><div class="line">japan-#     <span class="keyword">and</span> cty.admin_level = <span class="string">'7'</span></div><div class="line">japan-#     <span class="keyword">and</span> ST_Touches(tit.way,cty.way)</div><div class="line">japan-# ;</div><div class="line">      name       | admin_level</div><div class="line"><span class="comment">-----------------+-------------</span></div><div class="line"> 中央区          | 7</div><div class="line"> 千代田区        | 7</div><div class="line"> 墨田区 (Sumida) | 7</div><div class="line"> 荒川区          | 7</div><div class="line">(4 rows)</div></pre></td></tr></table></figure>

<p>あれ？文京区とかも接しているはずなんですが、、、</p>
<p>検索してみたところ、文京区のデータがそもそもありませんでした。<br>OSMにデータ登録されてないのか、うまくデータインポートできていないのかはナゾです。。。</p>
<p>他にもクロスしてる〜とか、ジオメトリの関係を表す検索条件はいっぱいあるようです！</p>
<p>SQLはずっと使っていますが、Geoな条件はちょっと勝手が違って戸惑いました。。。<br>SQLがあんまりキレーじゃないのは許してください。。。</p>
<p>今日はここまで！</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>すっかり勉強をサボってしまいましたが、<br>前回に引き続き、OSMのデータを使ってPostGISのGeoなSQLを学んでいきます！</p>
<p>今回はGeoな検索条件です。</p>
]]>
    
    </summary>
    
      <category term="postgis" scheme="http://jurishimizu.github.io/tags/postgis/"/>
    
      <category term="osm" scheme="http://jurishimizu.github.io/tags/osm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PostGISでGeoなSELECT]]></title>
    <link href="http://jurishimizu.github.io/2015/02/07/select-in-postgis/"/>
    <id>http://jurishimizu.github.io/2015/02/07/select-in-postgis/</id>
    <published>2015-02-07T11:05:03.000Z</published>
    <updated>2015-02-28T12:53:09.000Z</updated>
    <content type="html"><![CDATA[<p>PostGISの環境は整ったので、<br>OSMのデータを使ってPostGISのGeoなSQLについて、学んでいきたいと思います！</p>
<p>今日はGeoなSELECTです</p>
<a id="more"></a>

<p>まずはフツーにSELECTしてみると、、、</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> way <span class="keyword">from</span> planet_osm_point  <span class="keyword">where</span> name = <span class="string">'東京'</span>;</span></div><div class="line">                        way</div><div class="line"><span class="comment">----------------------------------------------------</span></div><div class="line"> 010100002031BF0D00A4703D6A13AD6D411F85EBA10E3D5041</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>こんな感じでわけがわかりません、、、</p>
<h4 id="ST_SRID">ST_SRID</h4>
<p>ジオメトリのSRIDを確認<br>テーブル定義を確認すればわかるんですけどね・・</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> ST_SRID(way) <span class="keyword">from</span> planet_osm_point  <span class="keyword">where</span> name = <span class="string">'東京'</span>;</span></div><div class="line"> st_srid</div><div class="line"><span class="comment">---------</span></div><div class="line">  900913</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<h4 id="ST_AsText">ST_AsText</h4>
<p>GeoなデータをTextで返してくれます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=#  <span class="operator"><span class="keyword">select</span> ST_Astext(way) <span class="keyword">from</span> planet_osm_point  <span class="keyword">where</span> name = <span class="string">'東京'</span>;</span></div><div class="line">           st_astext</div><div class="line"><span class="comment">-------------------------------</span></div><div class="line"> POINT(15558811.32 4256826.53)</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>私のデータのSRIDは900913、<a href="http://ja.wikipedia.org/wiki/%E3%83%A1%E3%83%AB%E3%82%AB%E3%83%88%E3%83%AB%E5%9B%B3%E6%B3%95" target="_blank" rel="external">メルカトル図法</a>なので、XY座標で返ってきます。</p>
<h4 id="ST_Transform">ST_Transform</h4>
<p>空間座標系を変換してくれます</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=#  <span class="operator"><span class="keyword">select</span> ST_Astext(ST_Transform(way,<span class="number">4326</span>)) <span class="keyword">from</span> planet_osm_point  <span class="keyword">where</span> name = <span class="string">'東京'</span>;</span></div><div class="line">                st_astext</div><div class="line"><span class="comment">------------------------------------------</span></div><div class="line"> POINT(139.767180114878 35.6810784606139)</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p><a href="http://ja.wikipedia.org/wiki/%E5%9C%B0%E7%90%86%E5%BA%A7%E6%A8%99%E7%B3%BB" target="_blank" rel="external">地理座標系</a>を使っている4326に変換したので、緯度経度になりましたね！</p>
<h4 id="ST_Simplify">ST_Simplify</h4>
<p>ジオメトリを「簡略化」したものを返します<br>たとえばクネクネの道を高縮尺のときは簡略化したい、、、なんていうときに使えます。</p>
<p>都庁を簡略化してみましょう</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">japan=# <span class="operator"><span class="keyword">select</span> name ,ST_Astext(way) <span class="keyword">from</span> planet_osm_polygon <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">'東 京都庁%'</span>;</span></div><div class="line">                                name                                 |             st_astext</div><div class="line"><span class="comment">---------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div><div class="line"> 東京都庁舎 第二本庁舎 (Tokyo Metropolitan Government Building No.2) | POLYGON((15550413.95 4257817.44,15550418.97 4257818.58,15550417.58 4257827.96,15550426.27 4257829.92,15550424.56 4257841.44,15550448.89 4257846.93,15550450.66 4257835.04,15550459.39 4257837.01,15550461.36 4257823.76,15550471.75 4257826.1,15550475.47 4257801.06,15550467.95 4257799.36,15550468.74 4257794.06,15550476.9 4257795.91,15550481.11 4257767.62,15550474.16 4257766.05,15550474.97 4257760.64,15550482.44257762.31,15550486.53 4257734.52,15550479.1 4257732.85,15550479.98 4257726.9,15550474.89 4257725.75,15550476.11 4257717.52,15550447.25 4257711.03,15550445.94 4257719.76,15550436.73 4257717.67,15550435.77 4257724.14,15550428.9 4257722.59,15550424.48 4257752.31,15550430.88 4257753.75,15550429.96 4257760.01,15550423.3 4257758.52,15550419.28 4257785.53,15550425.7 4257786.97,15550424.97 4257791.88,15550417.98 4257790.31,15550413.95 4257817.44))</div><div class="line"> 東京都庁舎 第一本庁舎 (Tokyo Metropolitan Government Building No.1) | POLYGON((15550365.85 4258023.11,15550373.12 4258024.66,15550371.66 4258031.54,15550379.49 4258033.2,15550377.03 4258044.83,15550406.24 4258051.04,15550408.39 4258040.91,15550416.42 4258042.61,15550417.74 4258036.42,15550427.38 4258038.46,15550433.63 4258008.99,15550422.58 4258006.65,15550432.79 4257958.54,15550441.95 4257960.49,15550447.51 4257934.2,15550437.02 4257931.98,15550438.75 4257923.78,15550430.27 4257921.97,15550432.86 4257909.71,15550403.65 4257903.51,15550401.37 4257914.26,15550393.99 4257912.69,15550392.39 4257920.22,15550385.48 4257918.75,15550379.91 4257945.03,15550388.16 4257946.78,15550377.96 4257994.9,15550372.1 4257993.66,15550365.85 4258023.11))</div><div class="line">(2 rows)</div><div class="line">japan=# <span class="operator"><span class="keyword">select</span> name ,ST_Astext(ST_Simplify(way,<span class="number">10</span>)) <span class="keyword">from</span> planet_osm_polygon <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">'東京都庁%'</span>;</span></div><div class="line">                                name                                 |                          st_astext</div><div class="line"><span class="comment">---------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div><div class="line"> 東京都庁舎 第二本庁舎 (Tokyo Metropolitan Government Building No.2) | POLYGON((15550413.95 4257817.44,15550424.56 4257841.44,15550448.89 4257846.93,15550471.75 4257826.1,15550486.53 4257734.52,15550476.11 4257717.52,15550428.9 4257722.59,15550413.95 4257817.44))</div><div class="line"> 東京都庁舎 第一本庁舎 (Tokyo Metropolitan Government Building No.1) | POLYGON((15550365.85 4258023.11,15550377.03 4258044.83,15550427.38 4258038.46,15550433.63 4258008.99,15550422.58 4258006.65,15550447.51 4257934.2,15550432.86 4257909.71,15550403.65 4257903.51,15550385.48 4257918.75,15550365.85 4258023.11))</div><div class="line">(2 rows)</div></pre></td></tr></table></figure>

<p>簡略化して、ポリゴンの頂点の数がぐっと減りました。</p>
<p>今回10を指定した二つ目の引数ですが、簡略化を行う場合のしきい値で、この値が大きければ大きいほど簡略化されます。</p>
<h4 id="ST_Area">ST_Area</h4>
<p>ポリゴンの面積を返します。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> name,ST_Area(way) <span class="keyword">from</span> planet_osm_polygon <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">'台東%'</span> <span class="keyword">and</span> boundary = <span class="string">'administrative'</span>;</span></div><div class="line">      name      |     st_area</div><div class="line"><span class="comment">----------------+------------------</span></div><div class="line"> 台東区 (Taitō) | 15340131.5390491</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>単位がSRIDに依存するらしいです。（900913が何の単位になるのかよくわからない。。。）<br>Geography型に変換するとメートル単位になるらしいのでやってみます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> name,ST_Area(Geography( ST_Transform( way,<span class="number">4326</span> ))) <span class="keyword">from</span> planet_osm_polygon <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">'台東%'</span> <span class="keyword">and</span> boundary = <span class="string">'administrative'</span>;</span></div><div class="line">      name      |     st_area</div><div class="line"><span class="comment">----------------+------------------</span></div><div class="line"> 台東区 (Taitō) | 10090876.0546307</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>台頭区の面積をググったところ、10.08 km² だったので、だいたい合ってますかね</p>
<h4 id="ST_Length">ST_Length</h4>
<p>LINEの長さを返します</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">japan=#  <span class="operator"><span class="keyword">select</span> name,ST_Length( way ) <span class="keyword">from</span> planet_osm_line <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">'京王電鉄京王線%'</span>;</span></div><div class="line"></div><div class="line">                  name                   |    st_length</div><div class="line"><span class="comment">-----------------------------------------+------------------</span></div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 1186.87117791301</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 370.687813260911</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 97.0250626921177</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 1021.35274896948</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) |  617.29770580598</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 87.7408468154708</div><div class="line">・・・・・・・</div></pre></td></tr></table></figure>

<p>同じ電鉄でもひとつの地物ではないので、たくさん結果が返ってきました。</p>
<p>これもメートルにしてみましょう</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> name,ST_Length( Geography( ST_Transform( way,<span class="number">4326</span> ))) <span class="keyword">from</span> planet_osm_line <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">'京王電鉄京王線%'</span>;</span></div><div class="line">                  name                   |    st_length</div><div class="line"><span class="comment">-----------------------------------------+------------------</span></div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 961.734727315897</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 301.046955913747</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 78.8656422237801</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) |  830.57417351145</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 501.064401755556</div><div class="line"> 京王電鉄京王線 (Keio Railway Keio Line) | 71.3841606965213</div><div class="line"> ・・・・・・・</div></pre></td></tr></table></figure>

<h4 id="ST_distance">ST_distance</h4>
<p>2つのジオメトリの距離を返します。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> ST_distance(kudan.way , tokyo.way) <span class="keyword">from</span> planet_osm_point kudan , planet_osm_point tokyo <span class="keyword">where</span> kudan.name = <span class="string">'九段下'</span> <span class="keyword">and</span> kudan.railway = <span class="string">'station'</span> <span class="keyword">and</span> tokyo.name = <span class="string">'東京'</span> <span class="keyword">and</span> tokyo.railway = <span class="string">'station'</span> ;</span></div><div class="line">   st_distance</div><div class="line"><span class="comment">------------------</span></div><div class="line"> 2640.28394709686</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>緯度経度の空間参照系にして、第3引数をfalseにするとメートルになるらしいのでやってみます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> ST_distance(ST_Transform(kudan.way,<span class="number">4326</span>) , ST_Transform(tokyo.way,<span class="number">4326</span>),<span class="literal">false</span>) <span class="keyword">from</span> planet_osm_point kudan , planet_osm_point tokyo <span class="keyword">where</span> kudan.name = <span class="string">'九段下'</span> <span class="keyword">and</span> kudan.railway = <span class="string">'station'</span> <span class="keyword">and</span> tokyo.name = <span class="string">'東京'</span> <span class="keyword">and</span> tokyo.railway = <span class="string">'station'</span> ;</span></div><div class="line">  st_distance</div><div class="line"><span class="comment">----------------</span></div><div class="line"> 2142.050032445</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>九段下と東京の距離は2kmくらいなのでだいたい合ってます。</p>
<p>他にもPostGISの機能はたくさんあるので、これから順次勉強していきます！！！</p>
<p>今日はここまで！</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>PostGISの環境は整ったので、<br>OSMのデータを使ってPostGISのGeoなSQLについて、学んでいきたいと思います！</p>
<p>今日はGeoなSELECTです</p>
]]>
    
    </summary>
    
      <category term="postgis" scheme="http://jurishimizu.github.io/tags/postgis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PostGISで使用されるSRIDについて]]></title>
    <link href="http://jurishimizu.github.io/2015/02/05/about-srid/"/>
    <id>http://jurishimizu.github.io/2015/02/05/about-srid/</id>
    <published>2015-02-05T12:52:30.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p>今までSRIDのことはあまり触れずに、フワフワとしていましたが、<br>そろそろちゃんと理解していないと先に進めなさそうなので、ちょっと整理したいと思います。<br><a id="more"></a><br>SRIDは<a href="http://www.geopacific.org/opensourcegis/gcngisbook/QGIS_book/7b2c17ae0/7b2c17ae07b2c37bc062955f716cd530686e2c57307cfb" target="_blank" rel="external">空間参照情報</a>を表しています。<br>空間参照系は、<a href="http://www.pasco.co.jp/recommend/word/word076/" target="_blank" rel="external">測地系</a>と<a href="http://ja.wikipedia.org/wiki/%E5%9C%B0%E7%90%86%E5%BA%A7%E6%A8%99%E7%B3%BB" target="_blank" rel="external">座標系</a>の組み合わせです。</p>
<h2 id="測地系">測地系</h2>
<p>測地系の代表格は、、、</p>
<ul>
<li><p>WGS84<br>アメリカで使用されている世界測地系<br>Googleマップで使われていて、世界的に一番メジャーな測地系</p>
</li>
<li><p>Tokyo<br>旧日本測地系とも呼ばれる<br>2002年からJGD2000から使用されるようになった</p>
</li>
<li><p>JGD2000<br>日本で使用されている世界測地系<br>WGS84とほとんど同じ</p>
</li>
</ul>
<h2 id="座標系">座標系</h2>
<p>座標系の代表格は、、、</p>
<ul>
<li><p><a href="http://ja.wikipedia.org/wiki/%E5%9C%B0%E7%90%86%E5%BA%A7%E6%A8%99%E7%B3%BB" target="_blank" rel="external">地理座標系</a><br>緯度経度で場所を表す。一番おなじみ</p>
</li>
<li><p><a href="http://ja.wikipedia.org/wiki/%E3%83%A1%E3%83%AB%E3%82%AB%E3%83%88%E3%83%AB%E5%9B%B3%E6%B3%95" target="_blank" rel="external">メルカトル図法</a><br>地球を円筒状にして、XY座標で場所を表す</p>
</li>
<li><p><a href="http://ja.wikipedia.org/wiki/%E5%B9%B3%E9%9D%A2%E7%9B%B4%E8%A7%92%E5%BA%A7%E6%A8%99%E7%B3%BB" target="_blank" rel="external">平面直角座標系</a><br>狭い範囲だけを投影して歪みを少なくして、投影する図法<br>３つの数字で場所を表す</p>
</li>
<li><p><a href="http://ja.wikipedia.org/wiki/%E3%83%A6%E3%83%8B%E3%83%90%E3%83%BC%E3%82%B5%E3%83%AB%E6%A8%AA%E3%83%A1%E3%83%AB%E3%82%AB%E3%83%88%E3%83%AB%E5%9B%B3%E6%B3%95" target="_blank" rel="external">UTM図法</a><br>地球を60に分けて、その範囲ごとに投影する図法</p>
</li>
</ul>
<h2 id="SRID">SRID</h2>
<p>よくつかわれるSRIDは、、、、</p>
<table>
<thead>
<tr>
<th style="text-align:left">SRID</th>
<th style="text-align:left">測地系</th>
<th style="text-align:left">座標系</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">4301</td>
<td style="text-align:left">Tokyo</td>
<td style="text-align:left">地理座標系</td>
</tr>
<tr>
<td style="text-align:left">30161〜30179</td>
<td style="text-align:left">Tokyo</td>
<td style="text-align:left">平面直角座標系1系〜19系</td>
</tr>
<tr>
<td style="text-align:left">102151〜102156</td>
<td style="text-align:left">Tokyo</td>
<td style="text-align:left">UTMゾーン51〜55</td>
</tr>
<tr>
<td style="text-align:left">4612</td>
<td style="text-align:left">JGD2000</td>
<td style="text-align:left">地理座標系</td>
</tr>
<tr>
<td style="text-align:left">2443〜2461</td>
<td style="text-align:left">JGD2000</td>
<td style="text-align:left">平面直角座標系1系〜19系</td>
</tr>
<tr>
<td style="text-align:left">3097〜3101</td>
<td style="text-align:left">JGD2000</td>
<td style="text-align:left">UTMゾーン51〜55</td>
</tr>
<tr>
<td style="text-align:left">4326</td>
<td style="text-align:left">WGS84</td>
<td style="text-align:left">地理座標系</td>
</tr>
<tr>
<td style="text-align:left">3857 , 900913</td>
<td style="text-align:left">WGS84</td>
<td style="text-align:left">メルカトル図法</td>
</tr>
</tbody>
</table>
<p>だいたいこんな感じです</p>
<p>平面直角座標系とUTMゾーンが 「〜」 ってなっているのは、地域によって座標の基準が変わるからです。<br>石川県だったら７系、、、みたいな感じです。</p>
<p>900913はGoogleマップで使われている、、、というより、Googleマップのための空間座標なようです。</p>
<p>google → 900913<br>！！！！</p>
<p>プログラミングというより、地理学の話ですね、、、</p>
<p>内容がかなり薄いですが、<br>いままでフワフワとしてた知識がちょっとだけスッキリしました。</p>
<p>このへんのことを踏まえて、これからPostGISの勉強をしていきたいと思います！！！</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>今までSRIDのことはあまり触れずに、フワフワとしていましたが、<br>そろそろちゃんと理解していないと先に進めなさそうなので、ちょっと整理したいと思います。<br>]]>
    
    </summary>
    
      <category term="postgis" scheme="http://jurishimizu.github.io/tags/postgis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[QGISのスタイルを変更＆画像を出力]]></title>
    <link href="http://jurishimizu.github.io/2015/01/29/output-image-in-qgis/"/>
    <id>http://jurishimizu.github.io/2015/01/29/output-image-in-qgis/</id>
    <published>2015-01-29T09:58:14.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p>今回は小ネタとして、QGISで表示されている画面を、画像として出力する方法をご紹介します</p>
<a id="more"></a>

<h2 id="QGISのスタイルの変更">QGISのスタイルの変更</h2>
<p>画像を出力する前に、見栄えをよくするために、スタイルを変更しましょう</p>
<p>レイヤ毎のスタイルは<br>レイヤを選択→右クリック→プロパティ→スタイル で変更できます</p>
<p><img src="QGIS_01.png" alt="レイヤプロパティ"></p>
<p>プロジェクトのスタイルは<br>プロジェクト→プロジェクトのプロパティ→一般情報 で変更します<br>背景色と選択した地物の色が選べます。</p>
<p><img src="QGIS_02.png" alt="プロジェクトのプロパティ"></p>
<h2 id="画像を出力">画像を出力</h2>
<p>プロジェクト→イメージで保存<br>出力形式を選んでSaveを押すだけです。<br>簡単ですね</p>
<p><img src="QGIS_03.png" alt="QGIS"></p>
<p>QGISで分析した結果をプレゼンで使う、、、なんていう場面で必要になると思われます。</p>
<p>画像を出力するという機会がなくても、<br>スタイルの変更方法は覚えておいた方がいいかなと思います。</p>
<p>というのも、<br>デフォルトの背景色は白なのですが、<br>レイヤを追加するとQGISが勝手にスタイルを決めるので、<br>たまにすっごく薄い黄色とかになって、とてつもなく見づらいのです、、、</p>
<p>私は背景色を黒、選択した地物を黄色にして、<br>レイヤは見づらかったら、ピンクとかブルーに適当に変えています</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>今回は小ネタとして、QGISで表示されている画面を、画像として出力する方法をご紹介します</p>
]]>
    
    </summary>
    
      <category term="qgis" scheme="http://jurishimizu.github.io/tags/qgis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[QGISでPostGISのデータを確認]]></title>
    <link href="http://jurishimizu.github.io/2015/01/29/display-postgis-data-in-qgis/"/>
    <id>http://jurishimizu.github.io/2015/01/29/display-postgis-data-in-qgis/</id>
    <published>2015-01-29T08:59:38.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p>前回、OSMのデータをDBに入れて、selectしたりしたわけですが、<br>やっぱり視覚的に「ちゃんと日本のデータが入った！」っていうのを確認したいですね。<br>ということで、今回は<a href="http://ja.wikipedia.org/wiki/QGIS" target="_blank" rel="external">QGIS</a>でデータの中身を確認してみます。<br><a id="more"></a><br>QGISはGISのツールの中でもメジャーな方なので、比較的情報もたくさんあります。<br>かなり奥深いツールですが、今回はデータを見てみるだけにしておきます。</p>
<p>QGISのインストールは<a href="http://www.qgis.org/ja/site/forusers/download.html" target="_blank" rel="external">こちらのページ</a>からインストーラを落として実行するだけです。</p>
<h2 id="QGISにデータを読み込む">QGISにデータを読み込む</h2>
<p>QGISを起動して、左側にあるゾウのマークをクリックします</p>
<p><img src="QGIS_01.png" alt="QGIS"></p>
<p>「PostGIS テーブルを追加」という画面が出てくるので、新規をクリック</p>
<p><img src="QGIS_02.png" alt="QGIS"></p>
<p>こんな感じで接続情報を書きます。<br>ホストは<a href="http://jurishimizu.github.io/2014/12/29/postgis-install-1/" target="_blank" rel="external">この記事</a>でつくった仮想環境です。<br>接続テストがでてきたら、OKをクリック</p>
<p><img src="QGIS_03.png" alt="QGIS"></p>
<p>「接続」ボタンを押すとテーブルの一覧がでてきます。<br>osmのデータが入っている４つのテーブルを選んで「追加」をクリック</p>
<p><img src="QGIS_04.png" alt="QGIS"></p>
<p>そうすると、レイヤーに選択したテーブルがでてきて、徐々に日本地図が現れます<br>（けっこう時間かかります）</p>
<p><img src="QGIS_05.png" alt="QGIS"></p>
<h2 id="地物を確認してみる">地物を確認してみる</h2>
<p>地図にのってる建物や道のことを<a href="http://wiki.openstreetmap.org/wiki/JA:%E5%9C%B0%E7%89%A9" target="_blank" rel="external">地物</a>といいます。<br>この地物をQGISで確認してみましょう。</p>
<p>＋ボタンを使って、東京駅のあるところまでズームします</p>
<p><img src="QGIS_06.png" alt="QGIS"></p>
<p>iボタン（地物情報表示）で地物をひとつ選んでみます</p>
<p><img src="QGIS_07.png" alt="QGIS"></p>
<p>そうすると、こんな画面がでてきて、DBの値がわかります</p>
<p><img src="QGIS_08.png" alt="QGIS"></p>
<p>こうやって視覚的に見れると、ちゃんと日本地図のデータが入ったんだなって実感しますね</p>
<p>今日はここまで！</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>前回、OSMのデータをDBに入れて、selectしたりしたわけですが、<br>やっぱり視覚的に「ちゃんと日本のデータが入った！」っていうのを確認したいですね。<br>ということで、今回は<a href="http://ja.wikipedia.org/wiki/QGIS" target="_blank" rel="external">QGIS</a>でデータの中身を確認してみます。<br>]]>
    
    </summary>
    
      <category term="postgis" scheme="http://jurishimizu.github.io/tags/postgis/"/>
    
      <category term="osm" scheme="http://jurishimizu.github.io/tags/osm/"/>
    
      <category term="qgis" scheme="http://jurishimizu.github.io/tags/qgis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[OSMのデータをPostGISのDBに入れてみる]]></title>
    <link href="http://jurishimizu.github.io/2015/01/12/osm-download/"/>
    <id>http://jurishimizu.github.io/2015/01/12/osm-download/</id>
    <published>2015-01-12T08:35:12.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://jurishimizu.github.io/2015/01/09/postgis-install-2/" target="_blank" rel="external">前回</a>、Geoなデータベースを作ったので、<br>今回はそこにGeoなデータを入れてみたいと思います</p>
<a id="more"></a>

<p><a href="http://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%88%E3%83%9E%E3%83%83%E3%83%97" target="_blank" rel="external">OSM（オープンストリートマップ）</a>のデータをいれてみます。<br>OSMは誰でも使用できて、だれでも編集できる地図なのです。<br>もちろんタダです。<br>そしてこのOSMを編集する人をマッパーと呼ぶらしいです。地図好きってけっこう多いんですね</p>
<p>他にも<a href="http://nlftp.mlit.go.jp" target="_blank" rel="external">国土数値情報</a>とか<a href="http://www.vegetation.biodic.go.jp/" target="_blank" rel="external">自然環境情報GIS</a>とか、<br>タダでダウンロードできるGISデータはたくさんあるようです。<br>それを組み合わせれば、いろいろ面白そうですね</p>
<h2 id="osm2pgsqlインストール">osm2pgsqlインストール</h2>
<p>OSMのデータを扱うために、<a href="http://wiki.openstreetmap.org/wiki/Osm2pgsql" target="_blank" rel="external">osm2pgsql</a>を入れます。<br>説明が英語だ、、、<br>OSMのデータをPostGISのDBにいれるためのツールってことでいいかと思います。。。</p>
<p>osm2pgsqlを入れるためは、他にもいろいろインストールが必要なのですが、<br>その辺もあんまり理解できていないので、<br>トライ&amp;エラーでやっていきたいと思います。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git clone https://github.com/openstreetmap/osm2pgsql</div><div class="line">$ <span class="built_in">cd</span> osm2pgsql</div><div class="line">$ ./autogen.sh</div><div class="line">./autogen.sh: line <span class="number">2</span>: autoreconf: command not found</div></pre></td></tr></table></figure>

<p>案の定エラーになりました、、、<br>libtoolが必要らしいので入れます</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ yum install libtool</div><div class="line">$ ./autogen.sh</div></pre></td></tr></table></figure>

<p>これでautogen.shは成功しました</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ ./configure --with-protobuf-c</div><div class="line">checking <span class="keyword">for</span> xml2-config... no</div><div class="line">configure: error:  does not exist or it is not an exectuable file</div></pre></td></tr></table></figure>

<p>またエラーだ、、、<br>libxml12を入れます</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ yum install libxml2 libxml2-devel</div><div class="line">$ ./configure --with-protobuf-c</div><div class="line">checking <span class="keyword">for</span> bzip2 compression library... no</div><div class="line">configure: error: required library not found</div></pre></td></tr></table></figure>

<p>別のエラーが、、、<br>bzip2をいれます</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ yum install bzip2 bzip2-devel</div><div class="line">$ ./configure --with-protobuf-c</div><div class="line">configure: error: geos-config does not exist or it is not an exectuable file</div></pre></td></tr></table></figure>

<p>今度はgeosです</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ yum install geos geos-devel</div><div class="line">$ ./configure --with-protobuf-c</div><div class="line">checking <span class="keyword">for</span> proj projection library... no</div><div class="line">configure: error: required library not found</div></pre></td></tr></table></figure>

<p>続いてproj、、、、</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ yum install proj proj-devel</div><div class="line">$ ./configure --with-protobuf-c</div><div class="line">checking <span class="keyword">for</span> protobuf-c usability... no</div><div class="line">configure: WARNING: protobuf-c support requested but headers or library not found. Specify valid prefix of protobuf-c using --with-protobuf-c=[DIR] or provide include directory and linker flags using --with-protobuf-c-inc and --with-protobuf-c-lib</div><div class="line">checking <span class="keyword">for</span> pg_config... no</div><div class="line">configure: error:  does not exist or it is not an exectuable file</div></pre></td></tr></table></figure>

<p>protobuf-cがない、、、</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ yum install protobuf-c protobuf-c-devel</div><div class="line">$ ./configure --with-protobuf-c</div><div class="line">checking <span class="keyword">for</span> pg_config... no</div><div class="line">configure: error:  does not exist or it is not an exectuable file</div></pre></td></tr></table></figure>

<p>pg_configがみつからないようですが、<br>これは環境変数を設定すればOKなようです</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">export</span> PATH=/usr/pgsql-<span class="number">9.3</span>/bin:<span class="variable">$PATH</span></div><div class="line">$ ./configure --with-protobuf-c</div><div class="line">checking <span class="keyword">if</span> more special flags are required <span class="keyword">for</span> pthreads... no</div><div class="line">checking <span class="keyword">for</span> boostlib &gt;= <span class="number">1.48</span>... configure: We could not detect the boost libraries (version <span class="number">1.48</span> or higher). If you have a staged boost library (still not installed) please specify <span class="variable">$BOOST_ROOT</span> <span class="keyword">in</span> your environment and <span class="keyword">do</span> not give a PATH to --with-boost option.  If you are sure you have boost installed, <span class="keyword">then</span> check your version number looking <span class="keyword">in</span> &lt;boost/version.hpp&gt;. See http://randspringer.de/boost <span class="keyword">for</span> more documentation.</div><div class="line">configure: error: cannot find Boost libraries, which are are required <span class="keyword">for</span> building osm2pgsql. Please install libboost-dev.</div></pre></td></tr></table></figure>

<p>Boostが必要なようです<br>これは手でいれないといけないみたい、、、</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ wget http://downloads.sourceforge.net/project/boost/boost/<span class="number">1.53</span>.<span class="number">0</span>/boost_1_53_0.tar.gz</div><div class="line">$ tar -xvzf boost_1_53_0.tar.gz</div><div class="line">$ <span class="built_in">cd</span> boost_1_53_0</div><div class="line">$ ./bootstrap.sh --prefix=/usr/local</div><div class="line">$ ./b2</div><div class="line">$ ./b2 install</div><div class="line">$ /sbin/ldconfig</div></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./configure --with-protobuf-c</div></pre></td></tr></table></figure>

<p>やっと成功しました。あとはmakeすればOK</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">make</span></div><div class="line">$ <span class="keyword">make</span> install</div></pre></td></tr></table></figure>

<p>やっとできました。。。。<br>長かった、、、</p>
<h2 id="OSMのデータをいれる">OSMのデータをいれる</h2>
<p>日本の最新の地図情報を落としてきて、DBに入れてみます</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ wget <span class="keyword">http</span>://download.geofabrik.de/asia/japan-latest.osm.pbf</div><div class="line">$ osm2pgsql -c -d japan -S /usr/<span class="built_in">local</span>/share/osm2pgsql/default.style <span class="comment">--host localhost japan-latest.osm.pbf</span></div><div class="line">osm2pgsql: error <span class="keyword">while</span> loading shared libraries: libboost_filesystem.so<span class="number">.1</span><span class="number">.53</span><span class="number">.0</span>: cannot <span class="built_in">open</span> shared object <span class="built_in">file</span>: No such <span class="built_in">file</span> <span class="operator">or</span> <span class="built_in">directory</span></div></pre></td></tr></table></figure>

<p>またエラーが、、、<br>libboost_filesystem.so* の場所を探して、環境変数に追加</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ sudo find / -<span class="property">name</span> libboost_filesystem.so*</div><div class="line">$ export LD_LIBRARY_PATH=/usr/<span class="keyword">local</span>/lib/</div><div class="line">$ osm2pgsql -c -d japan -S /usr/<span class="keyword">local</span>/share/osm2pgsql/default.style <span class="comment">--host localhost japan-latest.osm.pbf</span></div><div class="line">osm2pgsql SVN <span class="property">version</span> <span class="number">0.87</span><span class="number">.2</span>-dev (<span class="number">64</span>bit <span class="property">id</span> <span class="constant">space</span>)</div><div class="line"></div><div class="line">Using built-<span class="keyword">in</span> tag processing pipeline</div><div class="line">Using projection SRS <span class="number">900913</span> (Spherical Mercator)</div><div class="line">Setting up table: planet_osm_point</div><div class="line">Setting up table: planet_osm_line</div><div class="line">Setting up table: planet_osm_polygon</div><div class="line">Setting up table: planet_osm_roads</div><div class="line">Allocating memory <span class="keyword">for</span> dense node cache</div><div class="line">Out <span class="keyword">of</span> memory <span class="keyword">for</span> node cache dense index, <span class="keyword">try</span> using <span class="string">"--cache-strategy sparse"</span> instead</div><div class="line">Error occurred, cleaning up</div></pre></td></tr></table></figure>

<p>またエラーになってしまいました。<br><code>--cache-strategy sparse</code>のオプションをつけよと言われたので、その通りに、、、、</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ osm2pgsql -c -d japan -U postgres --cache-strategy sparse -S /usr/local/share/osm2pgsql/<span class="keyword">default</span>.style --host localhost japan-latest.osm.pbf</div><div class="line">osm2pgsql SVN version <span class="number">0.87</span>.<span class="number">2</span>-dev (<span class="number">64</span>bit id space)</div><div class="line"></div><div class="line"><span class="keyword">Using</span> built-<span class="keyword">in</span> tag processing pipeline</div><div class="line"><span class="keyword">Using</span> projection SRS <span class="number">900913</span> (Spherical Mercator)</div><div class="line">Setting up table: planet_osm_point</div><div class="line">Setting up table: planet_osm_line</div><div class="line">Setting up table: planet_osm_polygon</div><div class="line">Setting up table: planet_osm_roads</div><div class="line">Allocating memory <span class="keyword">for</span> sparse node cache</div><div class="line">Node-cache: cache=<span class="number">800</span>MB, maxblocks=<span class="number">102400</span>*<span class="number">8192</span>, allocation <span class="function"><span class="keyword">method</span>=1</span></div><div class="line"><span class="title">Mid</span>: Ram, scale=<span class="number">100</span></div><div class="line"></div><div class="line">Reading <span class="keyword">in</span> file: japan-latest.osm.pbf</div><div class="line">Processing: Node(<span class="number">52420</span>k <span class="number">859.3</span>k/s) Way(<span class="number">0</span>k <span class="number">0.00</span>k/s) Relation(<span class="number">0</span> <span class="number">0.00</span>/s)</div><div class="line">Node cache size <span class="keyword">is</span> too small <span class="keyword">to</span> fit all nodes. Please increase cache size</div><div class="line">Error occurred, cleaning up</div></pre></td></tr></table></figure>

<p>メモリが足りないので<code>-C</code>で指定してあげます。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ osm2pgsql -c -d japan -U postgres <span class="comment">--cache-strategy sparse -C 2400 -S /usr/local/share/osm2pgsql/default.style --host localhost japan-latest.osm.pbf</span></div><div class="line">osm2pgsql SVN version <span class="number">0.87</span><span class="number">.2</span>-dev (<span class="number">64</span>bit id space)</div><div class="line"></div><div class="line">Using built-<span class="keyword">in</span> tag processing pipeline</div><div class="line">Using projection SRS <span class="number">900913</span> (Spherical Mercator)</div><div class="line">Setting up <span class="built_in">table</span>: planet_osm_point</div><div class="line">Setting up <span class="built_in">table</span>: planet_osm_line</div><div class="line">Setting up <span class="built_in">table</span>: planet_osm_polygon</div><div class="line">Setting up <span class="built_in">table</span>: planet_osm_roads</div><div class="line">Allocating memory <span class="keyword">for</span> sparse node cache</div><div class="line">Out of memory <span class="keyword">for</span> sparse node cache, reduce <span class="comment">--cache size</span></div><div class="line">Error occurred, cleaning up</div></pre></td></tr></table></figure>

<p>そもそも、メモリが足りない、、、<br><code>-C</code>の値をいろいろ変えてみても、<br>メモリが多いとそもそもメモリがないよと怒られ、メモリが少ないとメモリが足りないと言われます、、、、<br>詰んだ、、、、</p>
<p>ここで諦めてはいけません<br><a href="http://jurishimizu.github.io/2014/12/29/postgis-install-1/" target="_blank" rel="external">この記事</a>で作った仮想環境のメモリを増やしましょう<br>まず今のメモリを確認</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>free</div><div class="line">             total       used       free     shared    buffers     cached</div><div class="line"><span class="constant">Mem</span><span class="symbol">:</span>        <span class="number">469452</span>     <span class="number">117408</span>     <span class="number">352044</span>          <span class="number">0</span>       <span class="number">2432</span>      <span class="number">42320</span></div><div class="line">-<span class="regexp">/+ buffers/cache</span><span class="symbol">:</span>      <span class="number">72656</span>     <span class="number">396796</span></div><div class="line"><span class="constant">Swap</span><span class="symbol">:</span>       <span class="number">950264</span>      <span class="number">25060</span>     <span class="number">925204</span></div></pre></td></tr></table></figure>

<p>vagrantの環境からログアウトして、Vagrantfileにメモリ割当の記述を追加</p>
<figure class="highlight Vagrantfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">config.vm.provider <span class="symbol">:virtualbox</span> <span class="keyword">do</span> |vb|</div><div class="line">  ・</div><div class="line">  ・</div><div class="line">  vb.customize [<span class="string">"modifyvm"</span>, <span class="symbol">:id</span>, <span class="string">"--memory"</span>, <span class="number">2048</span>]</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>

<p>vagrantを再起動して、メモリを確認</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>vagrant reload</div><div class="line"><span class="variable">$ </span>vagrant ssh</div><div class="line"><span class="variable">$ </span>free</div><div class="line">             total       used       free     shared    buffers     cached</div><div class="line"><span class="constant">Mem</span><span class="symbol">:</span>       <span class="number">1922488</span>     <span class="number">172968</span>    <span class="number">1749520</span>          <span class="number">0</span>       <span class="number">7184</span>      <span class="number">64644</span></div><div class="line">-<span class="regexp">/+ buffers/cache</span><span class="symbol">:</span>     <span class="number">101140</span>    <span class="number">1821348</span></div><div class="line"><span class="constant">Swap</span><span class="symbol">:</span>       <span class="number">950264</span>          <span class="number">0</span>     <span class="number">950264</span></div></pre></td></tr></table></figure>

<p>メモリが増えました。</p>
<p>しかし、この方法で<code>-C</code>の値を4200までふやしましたが、<br>エラーが解消されませんでした、、、、<br>やっぱり詰んだ、、、</p>
<p>と思っていましたが、slimモードを使うと、メモリが少なくてもいけるそうです。<br><code>--slim</code>を追加して、再実行！</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line">$ osm2pgsql -c -d japan -U postgres <span class="comment">--slim -C 4200 --cache-strategy sparse -S /usr/local/share/osm2pgsql/default.style --host localhost japan-latest.osm.pbf</span></div><div class="line">osm2pgsql SVN version 0.87.2-dev (64bit id space)</div><div class="line"></div><div class="line">Using built-in tag processing pipeline</div><div class="line">Using projection SRS 900913 (Spherical Mercator)</div><div class="line">Setting up table: planet_osm_point</div><div class="line">Setting up table: planet_osm_line</div><div class="line">Setting up table: planet_osm_polygon</div><div class="line">Setting up table: planet_osm_roads</div><div class="line">Allocating memory for sparse node <span class="operator"><span class="keyword">cache</span></span></div><div class="line">Node-<span class="keyword">cache</span>: <span class="keyword">cache</span>=<span class="number">4200</span>MB, maxblocks=<span class="number">537600</span>*<span class="number">8192</span>, allocation method=<span class="number">9</span></div><div class="line"><span class="keyword">Mid</span>: pgsql, scale=<span class="number">100</span> <span class="keyword">cache</span>=<span class="number">4200</span></div><div class="line">Setting up <span class="keyword">table</span>: planet_osm_nodes</div><div class="line">Setting up <span class="keyword">table</span>: planet_osm_ways</div><div class="line">Setting up <span class="keyword">table</span>: planet_osm_rels</div><div class="line"></div><div class="line">Reading <span class="keyword">in</span> file: japan-latest.osm.pbf</div><div class="line">Processing: Node(<span class="number">103668</span>k <span class="number">1.7</span>k/s) Way(<span class="number">9965</span>k <span class="number">10.77</span>k/s) Relation(<span class="number">23920</span> <span class="number">42.64</span>/s)  <span class="keyword">parse</span> <span class="keyword">time</span>: <span class="number">60967</span>s</div><div class="line">Node stats: total(<span class="number">103668009</span>), <span class="keyword">max</span>(<span class="number">3297129224</span>) <span class="keyword">in</span> <span class="number">59481</span>s</div><div class="line">Way stats: total(<span class="number">9965258</span>), <span class="keyword">max</span>(<span class="number">322927091</span>) <span class="keyword">in</span> <span class="number">925</span>s</div><div class="line">Relation stats: total(<span class="number">23920</span>), <span class="keyword">max</span>(<span class="number">4497829</span>) <span class="keyword">in</span> <span class="number">561</span>s</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_point</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_line</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_polygon</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_roads</div><div class="line">Setting up <span class="keyword">table</span>: planet_osm_nodes</div><div class="line">Setting up <span class="keyword">table</span>: planet_osm_ways</div><div class="line">Setting up <span class="keyword">table</span>: planet_osm_rels</div><div class="line"><span class="keyword">Using</span> built-<span class="keyword">in</span> tag processing pipeline</div><div class="line"></div><div class="line">Going over pending ways...</div><div class="line">  <span class="number">2856546</span> ways <span class="keyword">are</span> pending</div><div class="line"></div><div class="line"><span class="keyword">Using</span> <span class="number">1</span> helper-processes</div><div class="line">Finished processing <span class="number">2856546</span> ways <span class="keyword">in</span> <span class="number">1052</span> sec</div><div class="line"></div><div class="line"><span class="number">2856546</span> Pending ways took <span class="number">1052</span>s <span class="keyword">at</span> a rate <span class="keyword">of</span> <span class="number">2715.35</span>/s</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_point</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_line</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_polygon</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_roads</div><div class="line"></div><div class="line">Going over pending relations...</div><div class="line">  <span class="number">0</span> relations <span class="keyword">are</span> pending</div><div class="line"></div><div class="line"><span class="keyword">Using</span> <span class="number">1</span> helper-processes</div><div class="line">Finished processing <span class="number">0</span> relations <span class="keyword">in</span> <span class="number">0</span> sec</div><div class="line"></div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_point</div><div class="line">WARNING:  there <span class="keyword">is</span> <span class="keyword">no</span> <span class="keyword">transaction</span> <span class="keyword">in</span> progress</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_line</div><div class="line">WARNING:  there <span class="keyword">is</span> <span class="keyword">no</span> <span class="keyword">transaction</span> <span class="keyword">in</span> progress</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_polygon</div><div class="line">WARNING:  there <span class="keyword">is</span> <span class="keyword">no</span> <span class="keyword">transaction</span> <span class="keyword">in</span> progress</div><div class="line">Committing <span class="keyword">transaction</span> <span class="keyword">for</span> planet_osm_roads</div><div class="line">WARNING:  there <span class="keyword">is</span> <span class="keyword">no</span> <span class="keyword">transaction</span> <span class="keyword">in</span> progress</div><div class="line">Stopping <span class="keyword">table</span>: planet_osm_rels</div><div class="line">Building <span class="keyword">index</span> <span class="keyword">on</span> <span class="keyword">table</span>: planet_osm_rels (fastupdate=off)</div><div class="line">Stopping <span class="keyword">table</span>: planet_osm_ways</div><div class="line">Stopping <span class="keyword">table</span>: planet_osm_nodes</div><div class="line">Stopped <span class="keyword">table</span>: planet_osm_nodes <span class="keyword">in</span> <span class="number">0</span>s</div><div class="line">Sorting <span class="keyword">data</span> <span class="keyword">and</span> creating indexes <span class="keyword">for</span> planet_osm_point</div><div class="line">Sorting <span class="keyword">data</span> <span class="keyword">and</span> creating indexes <span class="keyword">for</span> planet_osm_line</div><div class="line">Sorting <span class="keyword">data</span> <span class="keyword">and</span> creating indexes <span class="keyword">for</span> planet_osm_polygon</div><div class="line">Building <span class="keyword">index</span> <span class="keyword">on</span> <span class="keyword">table</span>: planet_osm_ways (fastupdate=off)</div><div class="line">Sorting <span class="keyword">data</span> <span class="keyword">and</span> creating indexes <span class="keyword">for</span> planet_osm_roads</div><div class="line">Analyzing planet_osm_point finished</div><div class="line">Stopped <span class="keyword">table</span>: planet_osm_rels <span class="keyword">in</span> <span class="number">10</span>s</div><div class="line">Analyzing planet_osm_roads finished</div><div class="line">Analyzing planet_osm_polygon finished</div><div class="line">Analyzing planet_osm_line finished</div><div class="line">Copying planet_osm_point <span class="keyword">to</span> cluster <span class="keyword">by</span> geometry finished</div><div class="line">Creating geometry <span class="keyword">index</span> <span class="keyword">on</span>  planet_osm_point</div><div class="line">Copying planet_osm_roads <span class="keyword">to</span> cluster <span class="keyword">by</span> geometry finished</div><div class="line">Creating geometry <span class="keyword">index</span> <span class="keyword">on</span>  planet_osm_roads</div><div class="line">Creating osm_id <span class="keyword">index</span> <span class="keyword">on</span>  planet_osm_point</div><div class="line">Creating indexes <span class="keyword">on</span>  planet_osm_point finished</div><div class="line"><span class="keyword">All</span> indexes <span class="keyword">on</span>  planet_osm_point created  <span class="keyword">in</span> <span class="number">188</span>s</div><div class="line">Completed planet_osm_point</div><div class="line">Creating osm_id <span class="keyword">index</span> <span class="keyword">on</span>  planet_osm_roads</div><div class="line">Creating indexes <span class="keyword">on</span>  planet_osm_roads finished</div><div class="line"><span class="keyword">All</span> indexes <span class="keyword">on</span>  planet_osm_roads created  <span class="keyword">in</span> <span class="number">216</span>s</div><div class="line">Completed planet_osm_roads</div><div class="line">Copying planet_osm_polygon <span class="keyword">to</span> cluster <span class="keyword">by</span> geometry finished</div><div class="line">Creating geometry <span class="keyword">index</span> <span class="keyword">on</span>  planet_osm_polygon</div><div class="line">Creating osm_id <span class="keyword">index</span> <span class="keyword">on</span>  planet_osm_polygon</div><div class="line">Creating indexes <span class="keyword">on</span>  planet_osm_polygon finished</div><div class="line"><span class="keyword">All</span> indexes <span class="keyword">on</span>  planet_osm_polygon created  <span class="keyword">in</span> <span class="number">674</span>s</div><div class="line">Completed planet_osm_polygon</div><div class="line">Copying planet_osm_line <span class="keyword">to</span> cluster <span class="keyword">by</span> geometry finished</div><div class="line">Creating geometry <span class="keyword">index</span> <span class="keyword">on</span>  planet_osm_line</div><div class="line">Creating osm_id <span class="keyword">index</span> <span class="keyword">on</span>  planet_osm_line</div><div class="line">Creating indexes <span class="keyword">on</span>  planet_osm_line finished</div><div class="line"><span class="keyword">All</span> indexes <span class="keyword">on</span>  planet_osm_line created  <span class="keyword">in</span> <span class="number">1496</span>s</div><div class="line">Completed planet_osm_line</div><div class="line">Stopped <span class="keyword">table</span>: planet_osm_ways <span class="keyword">in</span> <span class="number">1873</span>s</div><div class="line">node <span class="keyword">cache</span>: stored: <span class="number">103668009</span>(<span class="number">100.00</span>%), storage efficiency: <span class="number">50.00</span>% (dense blocks: <span class="number">0</span>, sparse nodes: <span class="number">103668009</span>), hit rate: <span class="number">100.00</span>%</div><div class="line"></div><div class="line">Osm2pgsql took <span class="number">63895</span>s overall</div></pre></td></tr></table></figure>

<p>やっとできました。。。<br>長い道のりだった、、、、</p>
<h2 id="データを確認する">データを確認する</h2>
<p>ほんとに入ってるか、DBをのぞいてみましょう</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">sudo</span> su - postgres</div><div class="line">$ psql <span class="operator">-d</span> japan</div></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">japan=# \d</div><div class="line">               List of relations</div><div class="line"> Schema |        Name        | Type  |  Owner</div><div class="line"><span class="comment">--------+--------------------+-------+----------</span></div><div class="line"> public | geography_columns  | view  | postgres</div><div class="line"> public | geometry_columns   | view  | postgres</div><div class="line"> public | planet_osm_line    | table | postgres</div><div class="line"> public | planet_osm_nodes   | table | postgres</div><div class="line"> public | planet_osm_point   | table | postgres</div><div class="line"> public | planet_osm_polygon | table | postgres</div><div class="line"> public | planet_osm_rels    | table | postgres</div><div class="line"> public | planet_osm_roads   | table | postgres</div><div class="line"> public | planet_osm_ways    | table | postgres</div><div class="line"> public | raster_columns     | view  | postgres</div><div class="line"> public | raster_overviews   | view  | postgres</div><div class="line"> public | spatial_ref_sys    | table | postgres</div><div class="line">(12 rows)</div></pre></td></tr></table></figure>

<p>テーブルが増えてます！</p>
<p><code>planet_osm_polygon</code>に建物などの「面」の情報（ポリゴン）<br><code>planet_osm_line</code>に道路などの「線」の情報（ライン）<br><code>planet_osm_point</code>に「点」の情報（ポイント）が格納されています。<br>じゃあ、<code>planet_osm_roads</code>は何なのかというと、<br>縮尺が大きいときにつかわれる<code>planet_osm_line</code>のサブセットだそうです。<br>縮尺が大きいときに細い道まで全部表示したら大変だからってことでしょうかね<br>他の３つは中間テーブルのようです。</p>
<p>詳細は<a href="http://wiki.openstreetmap.org/wiki/JA:Osm2pgsql/schema" target="_blank" rel="external">コチラ</a></p>
<p>テーブルの定義をみてみます</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">japan=# \d planet_osm_polygon</div><div class="line">           Table "public.planet_osm_polygon"</div><div class="line">       Column       |          Type           | Modifiers</div><div class="line"><span class="comment">--------------------+-------------------------+-----------</span></div><div class="line"> osm_id             | bigint                  |</div><div class="line"> access             | text                    |</div><div class="line"> addr:housename     | text                    |</div><div class="line"> addr:housenumber   | text                    |</div><div class="line"> addr:interpolation | text                    |</div><div class="line">・・・・・・・</div><div class="line"> wetland            | text                      |</div><div class="line"> width              | text                      |</div><div class="line"> wood               | text                      |</div><div class="line"> z_order            | integer                   |</div><div class="line"> way_area           | real                      |</div><div class="line"> way                | geometry(Geometry,900913) |</div></pre></td></tr></table></figure>

<p>カラムが多い、、、、<br>最後にあるgeometryというデータ型がジオなデータなわけですね。<br>900913というナゾの数字、これは前回のブログでもふれた空間参照系を表しています。<br>繰り返しになりますが、DBで扱える空間参照系は<code>spatial_ref_sys</code>テーブルで管理しています。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> spatial_ref_sys <span class="keyword">where</span> srid=<span class="number">900913</span>;</span></div><div class="line">  srid  |       auth_name        | auth_srid |                                                                       srtext                                                                                                       |            proj4text</div><div class="line"><span class="comment">--------+------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------</span></div><div class="line"> 900913 | spatialreferencing.org |    900913 | PROJCS["Popular Visualisation CRS / Mercator (deprecated)",GEOGCS["Popular Visualisation CRS",DATUM["Popular_Visualisation_Datum",SPHEROID["Popular Visualisation Sphere",6378137,0,AUTHORITY["EPSG","7059"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6055"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.01745329251994328,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4055"]],UNIT["metre",1,AUTHORITY["EPSG","9001"]],PROJECTION["Mercator_1SP"],PARAMETER["central_meridian",0],PARAMETER["scale_factor",1],PARAMETER["false_easting",0],PARAMETER["false_northing",0],AUTHORITY["EPSG","3785"],AXIS["X",EAST],AXIS["Y",NORTH]] | +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>意味不明ですが、<a href="http://ja.wikipedia.org/wiki/%E6%B8%AC%E5%9C%B0%E7%B3%BB#.E4.B8.96.E7.95.8C.E6.B8.AC.E5.9C.B0.E7.B3.BB.E3.81.A8.E3.81.84.E3.81.86.E5.91.BC.E7.A7.B0" target="_blank" rel="external">WGS</a>と書いてあるので、世界測地系なのでしょう、、、<br>wayというカラムはこの空間参照系のデータだよっていうことですね。</p>
<p>テーブルの中身を見てみなしょう。<br>まずは件数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span>  planet_osm_polygon ;</span></div><div class="line">  count</div><div class="line"><span class="comment">---------</span></div><div class="line"> 2591940</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>カラムも多いけど、データ数も多いですね。日本全国なので、、、、<br>適当にselectしても混乱しそうなので、データの仕様を確認してみましょう。</p>
<p>OSMの仕様はこちらで確認できます。<br><a href="http://wiki.openstreetmap.org/wiki/JA:Map_Features" target="_blank" rel="external">http://wiki.openstreetmap.org/wiki/JA:Map_Features</a></p>
<p>例えば<a href="http://wiki.openstreetmap.org/wiki/JA:Map_Features#.E5.95.86.E6.A5.AD.E6.96.BD.E8.A8.AD" target="_blank" rel="external">このページ</a>をみれば、<br>buildingカラムに「commercial」が設定されていたらは「商業施設なんだな」ってわかるわけですね。<br>バーとかアイスクリーム屋さんまで指定できるみたいで、眺めてると結構面白いです。</p>
<p>商業施設をselectしてみましょう</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">select</span> name,building <span class="keyword">from</span> planet_osm_polygon <span class="keyword">where</span> building=<span class="string">'commercial'</span> <span class="keyword">limit</span> <span class="number">10</span> ;</span></div><div class="line">              name               |  building</div><div class="line"><span class="comment">---------------------------------+------------</span></div><div class="line"> 久米島町B&G海洋センター         | commercial</div><div class="line"> ヤマダ電機                      | commercial</div><div class="line">                                 | commercial</div><div class="line"> JPR那覇ビル (JPR Naha Building) | commercial</div><div class="line"> 和民 (Watami)                   | commercial</div><div class="line">                                 | commercial</div><div class="line"> A-Price                         | commercial</div><div class="line"> 西原シティ (Nishihara City)     | commercial</div><div class="line"> BEST                            | commercial</div><div class="line">                                 | commercial</div><div class="line">(10 rows)</div></pre></td></tr></table></figure>

<p>それっぽい検索結果になったので、ちゃんとデータが入ってるみたいです！<br>今日はここまで！！！</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><a href="http://jurishimizu.github.io/2015/01/09/postgis-install-2/" target="_blank" rel="external">前回</a>、Geoなデータベースを作ったので、<br>今回はそこにGeoなデータを入れてみたいと思います</p>
]]>
    
    </summary>
    
      <category term="vagrant" scheme="http://jurishimizu.github.io/tags/vagrant/"/>
    
      <category term="centos" scheme="http://jurishimizu.github.io/tags/centos/"/>
    
      <category term="virtualized_environment" scheme="http://jurishimizu.github.io/tags/virtualized-environment/"/>
    
      <category term="postgis" scheme="http://jurishimizu.github.io/tags/postgis/"/>
    
      <category term="osm" scheme="http://jurishimizu.github.io/tags/osm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[yumを使わずにwgetでPostGISをインストール]]></title>
    <link href="http://jurishimizu.github.io/2015/01/09/postgis-install-extla/"/>
    <id>http://jurishimizu.github.io/2015/01/09/postgis-install-extla/</id>
    <published>2015-01-09T09:18:40.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://jurishimizu.github.io/2015/01/09/postgis-install-2/" target="_blank" rel="external">前回</a>はあっさりとyumでPOSTGISをインストールしましたが、<br>諸事情でyumを使えないこともあるってことで、yumを使わないインストール方法を書いておきます。<br>PostgreSQLのインストールは省いてます、、、</p>
<a id="more"></a>

<h1 id="PostGISをインストール">PostGISをインストール</h1>
<p><a href="http://www.torutk.com/projects/swe/wiki/PROJ4" target="_blank" rel="external">PROJ</a>インストール</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="char">$ </span>wget <span class="method">http:</span>//download.osgeo.org/proj/proj-<span class="number">4.8</span><span class="number">.0</span>.tar.gz</div><div class="line"><span class="char">$ </span>tar xvfz  proj-<span class="number">4.8</span><span class="number">.0</span>.tar.gz</div><div class="line"><span class="char">$ </span>cd proj-<span class="number">4.8</span><span class="number">.0</span></div><div class="line"><span class="char">$ </span>./configure --prefix=/opt/geo</div><div class="line"><span class="char">$ </span>make</div><div class="line"><span class="char">$ </span>make install</div></pre></td></tr></table></figure>

<p><a href="http://www.informatix.co.jp/top/club2/coding/contents/cont140207-12.html" target="_blank" rel="external">GEOS</a>インストール</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="char">$ </span>wget <span class="method">http:</span>//download.osgeo.org/geos/geos-<span class="number">3.4</span><span class="number">.2</span>.tar.bz2</div><div class="line"><span class="char">$ </span>tar -jxvf geos-<span class="number">3.4</span><span class="number">.2</span>.tar.bz2</div><div class="line"><span class="char">$ </span>cd geos-<span class="number">3.4</span><span class="number">.2</span></div><div class="line"><span class="char">$ </span>./configure --prefix=/opt/geo</div><div class="line"><span class="char">$ </span>make</div><div class="line"><span class="char">$ </span>make install</div></pre></td></tr></table></figure>

<p><a href="http://ja.wikipedia.org/wiki/GDAL" target="_blank" rel="external">GDAL</a>インストール</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/download.osgeo.org/gdal</span><span class="regexp">/1.10.0/gdal</span>-<span class="number">1.10</span>.<span class="number">0</span>.tar.gz</div><div class="line"><span class="variable">$ </span>tar xvfz gdal-<span class="number">1.10</span>.<span class="number">0</span>.tar.gz</div><div class="line"><span class="variable">$ </span>cd gdal-<span class="number">1.10</span>.<span class="number">0</span></div><div class="line"><span class="variable">$ </span>./configure --prefix=<span class="regexp">/opt/geo</span></div><div class="line"><span class="variable">$ </span>make</div><div class="line"><span class="variable">$ </span>make install</div></pre></td></tr></table></figure>

<p>PostGISインストール</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/download.osgeo.org/postgis</span><span class="regexp">/source/postgis</span>-<span class="number">2.0</span>.<span class="number">4</span>.tar.gz</div><div class="line"><span class="variable">$ </span>tar xvfz postgis-<span class="number">2.0</span>.<span class="number">4</span>.tar.gz</div><div class="line"><span class="variable">$ </span>cd postgis-<span class="number">2.0</span>.<span class="number">4</span></div><div class="line"><span class="variable">$ </span>./configure --prefix=<span class="regexp">/opt/geo</span> --with-projdir=<span class="regexp">/opt/geo</span> --with-gdalconfig=<span class="regexp">/opt/geo</span><span class="regexp">/bin/gdal</span>-config</div><div class="line"><span class="variable">$ </span>make</div><div class="line"><span class="variable">$ </span>make install</div></pre></td></tr></table></figure>

<p>PROJとGEOSのライブラリを /etc/ld.so.conf に登録</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">vi</span> /etc/ld.<span class="keyword">so</span>.<span class="keyword">conf</span></div><div class="line"></div><div class="line">下記を追記</div><div class="line">/<span class="keyword">opt</span>/geo/lib</div></pre></td></tr></table></figure>

<p>あとは<br><a href="http://jurishimizu.github.io/2015/01/09/postgis-install-2/" target="_blank" rel="external">前回</a>と同じ手順でOKです。</p>
<p>/etc/ld.so.conf を編集を忘れるとこんな感じのエラーになります</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># <span class="operator"><span class="keyword">create</span> extension postgis;</span></div><div class="line">ERROR:  could not <span class="operator"><span class="keyword">load</span> library <span class="string">"/usr/lib/pgsql/postgis-2.0.so"</span>: /usr/lib/pgsql/postgis-<span class="number">2.0</span>.so: undefined symbol: pj_get_spheroid_defn</span></div></pre></td></tr></table></figure>

<p>PROJのバージョンが4.8より古い場合にも同じエラーになるみたいです。</p>
<p>PostGISを使うときは、PROJとかGDALとか、いろいろ必要なのですね。<br>yumでインストールしたときは、勝手にインストールしてくれてたってことですね。<br>yumって便利ですね、、、</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><a href="http://jurishimizu.github.io/2015/01/09/postgis-install-2/" target="_blank" rel="external">前回</a>はあっさりとyumでPOSTGISをインストールしましたが、<br>諸事情でyumを使えないこともあるってことで、yumを使わないインストール方法を書いておきます。<br>PostgreSQLのインストールは省いてます、、、</p>
]]>
    
    </summary>
    
      <category term="centos" scheme="http://jurishimizu.github.io/tags/centos/"/>
    
      <category term="postgis" scheme="http://jurishimizu.github.io/tags/postgis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CentOSにPostgreSQL/PostGISの環境構築]]></title>
    <link href="http://jurishimizu.github.io/2015/01/09/postgis-install-2/"/>
    <id>http://jurishimizu.github.io/2015/01/09/postgis-install-2/</id>
    <published>2015-01-09T02:46:17.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://jurishimizu.github.io/2014/12/29/Postgis-install-1/" target="_blank" rel="external">前回</a>作った仮想環境に、<br><a href="http://ja.wikipedia.org/wiki/Postgis" target="_blank" rel="external">PostGIS</a>をインストールしてみます。<br>PostGISを入れるとPostgreSQLで地理空間情報が扱えるようになってしまうのです。<br>データベースで地理情報を扱えるなんてビックリです。</p>
<a id="more"></a>

<h1 id="PostgreSQL/PostGISをインストール">PostgreSQL/PostGISをインストール</h1>
<p>前回作成した仮想環境に接続して、Postgisをインストールします</p>
<p>仮想環境に接続</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>vagrant ssh</div></pre></td></tr></table></figure>

<p>PostgreSQLとPostGISインストール</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>rpm -ivh <span class="symbol">http:</span>/<span class="regexp">/yum.postgresql.org/</span><span class="number">9.3</span>/redhat/rhel-<span class="number">6</span>-x86_64/pgdg-centos93-<span class="number">9.3</span>-<span class="number">1</span>.noarch.rpm</div><div class="line"><span class="variable">$ </span>yum -y install postgresql93 postgresql93-server postgresql93-libspostgresql93-contrib postgresql93-devel</div><div class="line"><span class="variable">$ </span>rpm -ivh <span class="symbol">http:</span>/<span class="regexp">/dl.fedoraproject.org/pub</span><span class="regexp">/epel/</span><span class="number">6</span>/x86_64/epel-release-<span class="number">6</span>-<span class="number">8</span>.noarch.rpm</div><div class="line"><span class="variable">$ </span>yum -y install <span class="constant">Postgis2_93</span></div></pre></td></tr></table></figure>

<p>バージョン確認</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ psql --version</div><div class="line"><span class="function"><span class="title">psql</span> <span class="params">(<span class="variable">PostgreSQL</span>)</span> 9.3.5</span></div></pre></td></tr></table></figure>

<p>自動起動をonにする</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ chkconfig postgresql-<span class="number">9.3</span> <span class="function_start"><span class="keyword">on</span></span></div><div class="line">$ chkconfig <span class="comment">--list postgresql-9.3</span></div><div class="line">postgresql-<span class="number">9.3</span> 	<span class="number">0</span>:off	<span class="number">1</span>:off	<span class="number">2</span>:<span class="function_start"><span class="keyword">on</span></span>	<span class="number">3</span>:<span class="function_start"><span class="keyword">on</span></span>	<span class="number">4</span>:<span class="function_start"><span class="keyword">on</span></span>	<span class="number">5</span>:<span class="function_start"><span class="keyword">on</span></span>	<span class="number">6</span>:off</div></pre></td></tr></table></figure>

<p>DB初期化</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="class"><span class="keyword">service</span> <span class="title">postgresql</span>-9.3 initdb</span></div><div class="line">Initializing database:                                     [  OK  ]</div></pre></td></tr></table></figure>

<p>外部からのアクセスを許可するように設定を変更する<br>postgresql.conf編集</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">vi</span> /var/lib/pgsql/<span class="number">9.3</span>/data/pg_hba.<span class="keyword">conf</span></div><div class="line"> </div><div class="line"> 変更前</div><div class="line"> host    <span class="keyword">all</span>             <span class="keyword">all</span>             <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">32</span>            ident</div><div class="line"> 変更後</div><div class="line"> host    <span class="keyword">all</span>             <span class="keyword">all</span>             <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            trust</div></pre></td></tr></table></figure>

<p>pg_hba.conf編集</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ vi /var/lib/pgsql/<span class="number">9.3</span>/data/pg_hba.conf</div><div class="line"></div><div class="line"> 変更前</div><div class="line"> <span class="comment"># listen_addresses = ‘localhost’</span></div><div class="line"> <span class="comment"># port = 5432</span></div><div class="line"> 変更後</div><div class="line"> <span class="variable">listen_addresses =</span> ‘*’</div><div class="line"> <span class="variable">port =</span> <span class="number">5432</span></div></pre></td></tr></table></figure>

<p>サーバ起動</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ service postgresql-9.3 <span class="operator"><span class="keyword">start</span></span></div><div class="line"><span class="keyword">Starting</span> postgresql-<span class="number">9.3</span> service:                           [  OK  ]</div></pre></td></tr></table></figure>

<h2 id="Geoなデータベースを作成">Geoなデータベースを作成</h2>
<p>まずは普通にデータベースを作成<br>後で日本地図のデータを入れたいので、名前はjapanにします</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>sudo su - postgres</div><div class="line"><span class="variable">$ </span>createdb japan</div></pre></td></tr></table></figure>

<p>ログインして<code>create extension Postgis;</code>を実行します</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ psql <span class="operator">-d</span> japan</div></pre></td></tr></table></figure>



<figure class="highlight SQL"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">japan=# <span class="operator"><span class="keyword">create</span> extension Postgis;</span></div><div class="line"><span class="operator"><span class="keyword">CREATE</span> EXTENSION</span></div><div class="line">japan=# <span class="keyword">SELECT</span> Postgis_full_version() ;</div><div class="line">                                                                        Postgis_full_version</div><div class="line"></div><div class="line"><span class="comment">---------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div><div class="line"> Postgis="2.1.5 r13152" GEOS="3.4.2-CAPI-1.8.2 r3921" PROJ="Rel. 4.8.0, 6 March2012" GDAL="GDAL 1.9.2, released 2012/10/08" LIBXML="2.7.6" LIBJSON="UNKNOWN" RASTER</div><div class="line">(1 row)</div></pre></td></tr></table></figure>

<p>これでGeoなデータベースの出来上がりです！</p>
<p>ここでデータベースの中身を確認してみます</p>
<figure class="highlight SQL"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">japan=# \d</div><div class="line">               List of relations</div><div class="line"> Schema |       Name        | Type  |  Owner</div><div class="line"><span class="comment">--------+-------------------+-------+----------</span></div><div class="line"> public | geography_columns | view  | postgres</div><div class="line"> public | geometry_columns  | view  | postgres</div><div class="line"> public | raster_columns    | view  | postgres</div><div class="line"> public | raster_overviews  | view  | postgres</div><div class="line"> public | spatial_ref_sys   | table | postgres</div><div class="line">(5 rows)</div></pre></td></tr></table></figure>

<p>まだ何もしてないのに、テーブルとビューができてます。<br>このおかげでGeoなデータが扱えるようになるみたいですね。</p>
<p><code>spatial_ref_sys</code>の中身を除いてみます。</p>
<figure class="highlight SQL"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">japan=# \d spatial_ref_sys</div><div class="line">         Table "public.spatial_ref_sys"</div><div class="line">  Column   |          Type           | Modifiers</div><div class="line"><span class="comment">-----------+-------------------------+-----------</span></div><div class="line"> srid      | integer                 | not null</div><div class="line"> auth_name | character varying(256)  |</div><div class="line"> auth_srid | integer                 |</div><div class="line"> srtext    | character varying(2048) |</div><div class="line"> proj4text | character varying(2048) |</div><div class="line">Indexes:</div><div class="line">    "spatial_ref_sys_pkey" PRIMARY KEY, btree (srid)</div><div class="line"><span class="operator"><span class="keyword">Check</span> <span class="keyword">constraints</span>:</span></div><div class="line">    <span class="string">"spatial_ref_sys_srid_check"</span> <span class="keyword">CHECK</span> (srid &gt; <span class="number">0</span> <span class="keyword">AND</span> srid &lt;= <span class="number">998999</span>)</div></pre></td></tr></table></figure>

<p>このテーブルはデータベース中で利用できるすべての<a href="http://www.geopacific.org/opensourcegis/gcngisbook/QGIS_book/7b2c17ae0/7b2c17ae07b2c37bc062955f716cd530686e2c57307cfb" target="_blank" rel="external">空間参照情報</a>を定義しています。<br>空間参照情報って何？？？って感じですが、要はその空間情報がどういう基準で作成されているか？ってことだと思います。<br>（たぶんもっともっと奥深いものですが、まだあまり理解できてません、、、）</p>
<p>この辺はもうちょっと勉強してから記事を書きたいと思います。</p>
<p>次回は、このデータベースにデータを入れていきたいと思います！！！</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><a href="http://jurishimizu.github.io/2014/12/29/Postgis-install-1/" target="_blank" rel="external">前回</a>作った仮想環境に、<br><a href="http://ja.wikipedia.org/wiki/Postgis" target="_blank" rel="external">PostGIS</a>をインストールしてみます。<br>PostGISを入れるとPostgreSQLで地理空間情報が扱えるようになってしまうのです。<br>データベースで地理情報を扱えるなんてビックリです。</p>
]]>
    
    </summary>
    
      <category term="vagrant" scheme="http://jurishimizu.github.io/tags/vagrant/"/>
    
      <category term="centos" scheme="http://jurishimizu.github.io/tags/centos/"/>
    
      <category term="virtualized_environment" scheme="http://jurishimizu.github.io/tags/virtualized-environment/"/>
    
      <category term="postgresql" scheme="http://jurishimizu.github.io/tags/postgresql/"/>
    
      <category term="postgis" scheme="http://jurishimizu.github.io/tags/postgis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Vagrantで仮想環境を作成]]></title>
    <link href="http://jurishimizu.github.io/2014/12/29/postgis-install-1/"/>
    <id>http://jurishimizu.github.io/2014/12/29/postgis-install-1/</id>
    <published>2014-12-29T08:40:17.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p>これから勉強するために仮想環境をつくります。<br>自分のPCでやってもいいのですが、失敗した時のことを考えて、、、</p>
<a id="more"></a>

<h1 id="仮想環境を作ってみる">仮想環境を作ってみる</h1>
<p>Vagrant と VirtualBox を使って、仮想環境を作ってみます。</p>
<h2 id="Vagrant_をインストール">Vagrant をインストール</h2>
<p>こちらのサイトからdmgファイルをインストール</p>
<p><a href="http://www.vagrantup.com/downloads.html" target="_blank" rel="external">Download Vagrant – Vagrant</a></p>
<p>インストール後、バージョン確認</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ vagrant --version</div><div class="line">Vagrant <span class="number">1.7</span>.<span class="number">1</span></div></pre></td></tr></table></figure>

<h2 id="VirtualBox_をインストール">VirtualBox をインストール</h2>
<p>こちらのサイトからdmgファイルをインストール</p>
<p><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="external">Downloads – Oracle VM VirtualBox</a></p>
<p>Launcpad に VirtualBox のアイコンがあればOK</p>
<h2 id="仮想マシンを作成">仮想マシンを作成</h2>
<p>まずはboxを確認</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ vagrant box list</div><div class="line">centos65        (virtualbox, <span class="number">0</span>)</div><div class="line">chef/centos-<span class="number">6.5</span> (virtualbox, <span class="number">1.0</span>.<span class="number">0</span>)</div><div class="line">precise32       (virtualbox, <span class="number">0</span>)</div></pre></td></tr></table></figure>

<p>Vagrantfileを作成</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p ./Vagrant/CentOS65</div><div class="line">$ <span class="built_in">cd</span> ./Vagrant/CentOS65</div><div class="line">$ vagrant init chef/centos-<span class="number">6.5</span></div><div class="line">A `Vagrantfile` has been placed <span class="keyword">in</span> this directory. You are now</div><div class="line">ready to `vagrant up` your first virtual environment! Please <span class="built_in">read</span></div><div class="line">the comments <span class="keyword">in</span> the Vagrantfile as well as documentation on</div><div class="line">`vagrantup.com` <span class="keyword">for</span> more information on using Vagrant.</div><div class="line">$ ls</div><div class="line">Vagrantfile</div></pre></td></tr></table></figure>

<p>作成されたVagrantfileの中身を確認して、<code>config.vm.box = &quot;chef/centos-6.5&quot;</code>となっていれば大丈夫。</p>
<p>VMを起動する</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ vagrant up</div><div class="line">Bringing machine <span class="string">'default'</span> up with <span class="string">'virtualbox'</span> provider...</div><div class="line">==&gt; default: Importing base box <span class="string">'chef/centos-6.5'</span>...</div><div class="line">・・・</div></pre></td></tr></table></figure>

<h2 id="ネットワーク設定をする">ネットワーク設定をする</h2>
<p>Vagrantfileの下記の記述のコメントアウトを削除</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="array"># config.vm.network </span><span class="string">"private_network"</span>, ip: <span class="string">"192.168.33.10"</span></div></pre></td></tr></table></figure>



<p>vagrant のリロード</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ vagrant reload</div><div class="line">==&gt; default: Attempting graceful shutdown of VM...</div><div class="line">==&gt; default: Checking <span class="keyword">if</span> box <span class="string">'chef/centos-6.5'</span> is up to date...</div><div class="line">・・・</div></pre></td></tr></table></figure>

<p>これで192.168.33.10 というIPでアクセスできるようになりました</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ ping <span class="number">192.168</span>.<span class="number">33.10</span></div><div class="line">PING <span class="number">192.168</span>.<span class="number">33.10</span> (<span class="number">192.168</span>.<span class="number">33.10</span>): <span class="number">56</span> data bytes</div><div class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">33.10</span>: icmp_seq=<span class="number">0</span> ttl=<span class="number">64</span> time=<span class="number">0.585</span> ms</div><div class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">33.10</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.583</span> ms</div></pre></td></tr></table></figure>

<h2 id="仮想環境に接続">仮想環境に接続</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ vagrant ssh</div><div class="line">Last login: Mon Dec <span class="number">29</span> <span class="number">09</span>:<span class="number">03</span>:<span class="number">57</span> <span class="number">2014</span> from <span class="number">10.0</span>.<span class="number">2.2</span></div><div class="line">[vagrant@localhost ~]$</div></pre></td></tr></table></figure>

<p>これで、仮想環境の準備はOK！</p>
<p>というわけで、今日はここまで、、、、<br>Geoな話までいかなかった、、、、</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>これから勉強するために仮想環境をつくります。<br>自分のPCでやってもいいのですが、失敗した時のことを考えて、、、</p>
]]>
    
    </summary>
    
      <category term="vagrant" scheme="http://jurishimizu.github.io/tags/vagrant/"/>
    
      <category term="centos" scheme="http://jurishimizu.github.io/tags/centos/"/>
    
      <category term="virtualized_environment" scheme="http://jurishimizu.github.io/tags/virtualized-environment/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[GISについて]]></title>
    <link href="http://jurishimizu.github.io/2014/12/29/aboutGIS/"/>
    <id>http://jurishimizu.github.io/2014/12/29/aboutGIS/</id>
    <published>2014-12-29T08:12:25.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p>GeoなSEってどんなSEなのかっていうと<br><a href="http://ja.wikipedia.org/wiki/%E5%9C%B0%E7%90%86%E6%83%85%E5%A0%B1%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0" target="_blank" rel="external">GIS</a>を自由自在に扱えるSEだと思います。</p>
<a id="more"></a>

<p>GISと呼ばれるものはたくさんありますが、<br>他のメジャーな技術と比べるとやっぱり情報量が少なかったり、<br>情報があっても英語だったりするのが難儀なところです、、、</p>
<p>さらに、GISを扱うためには、基本的な地理学の知識も必要になります。</p>
<p>私が思う、今まで全く知らなかったけど、GISを扱う上で大切な地理の知識No1は、<br>ズバリ<a href="http://www.pasco.co.jp/recommend/word/word076/" target="_blank" rel="external">測地系</a>です。<br>この測地系が違うと、同じ緯度経度でも違う場所を指すことになるので、<br>複数のデータを組み合わせたりするときは意識しないと大変なことになってしまうのです。</p>
<p>聞きなれない用語が他にもたくさんでてきますが、<br>その都度調べて理解していくしかないですね、、、<br>GISの用語集としてはこのサイトがわかりやすいです。</p>
<p><a href="http://www.pasco.co.jp/recommend/word/" target="_blank" rel="external">http://www.pasco.co.jp/recommend/word/</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>GeoなSEってどんなSEなのかっていうと<br><a href="http://ja.wikipedia.org/wiki/%E5%9C%B0%E7%90%86%E6%83%85%E5%A0%B1%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0" target="_blank" rel="external">GIS</a>を自由自在に扱えるSEだと思います。</p>
]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[はじめに]]></title>
    <link href="http://jurishimizu.github.io/2014/12/29/Introduction/"/>
    <id>http://jurishimizu.github.io/2014/12/29/Introduction/</id>
    <published>2014-12-29T08:10:33.000Z</published>
    <updated>2015-02-15T11:26:44.000Z</updated>
    <content type="html"><![CDATA[<p>Geoはgeographic（地理的な, 地理学の）です。<br>地理につよいSEを目指します。</p>
<a id="more"></a>

<p>経験も知識もないですが、<br>カッコイイ地図をサクッと作ったり、<br>地理情報を使ったサービスが作れるようになりたいです</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Geoはgeographic（地理的な, 地理学の）です。<br>地理につよいSEを目指します。</p>
]]>
    
    </summary>
    
  </entry>
  
</feed>
